<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pay Here ‚Äî UPI Payment</title>
  <style>
    :root{
      --page-bg:#eef6fb;
      --panel:#ffffff;
      --muted:#6b7280;
      --accent:#0b61ff;
      --radius:12px;
      --shadow:0 10px 30px rgba(12,20,40,0.06);
      --light-gray:#f3f4f6;
      --copy-gray:#eef2f6;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--page-bg);color:#0f1724}

    /* container */
    .page{max-width:760px;margin:18px auto;padding:0 12px}
    .card{background:linear-gradient(180deg,#f8fcff,#ffffff);border-radius:16px;padding:14px;box-shadow:var(--shadow);overflow:hidden}

    /* topbar */
    .topbar{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg,#e6f5ff,#dff2ff)}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#0b61ff,#33a1ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
    .title{font-size:26px;font-style:italic;color:#08324a;font-weight:800;letter-spacing:0.3px}

    /* QR area */
    .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px}
    .qr-frame{width:320px;height:320px;border-radius:12px;border:1px dashed rgba(8,12,20,0.06);overflow:hidden;background:#fff;display:grid;place-items:center}
    .qr-frame img{width:100%;height:100%;object-fit:cover;display:block}
    .controls{display:flex;gap:10px;align-items:center;width:92%}
    .download{flex:1;padding:12px;border-radius:18px;background:linear-gradient(90deg,#dff7e1,#c6f0c9);border:1px solid rgba(10,91,46,0.08);font-weight:700;cursor:pointer}

    /* UPI single thin box with copy inside */
    .upi-box{margin-top:10px;display:flex;align-items:center;gap:8px;width:92%}
    .upi-pill{flex:1;display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;background:#fafcff;border:1px solid rgba(8,12,20,0.06);font-weight:700}
    .upi-text{font-size:15px;color:#0b1f2f}
    .copy-btn{padding:6px 10px;border-radius:8px;background:var(--copy-gray);color:#425066;border:0;cursor:pointer;font-weight:700}

    /* apps */
    .apps{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .app-btn{padding:12px;border-radius:10px;border:0;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center}
    /* slightly darker variants (requested) */
    .paytm{background:linear-gradient(90deg,#dfeaff,#bfdcff);color:#002a55}
    .gpay{background:linear-gradient(90deg,#fff9f0,#fff0df);color:#111;border:1px solid rgba(0,0,0,0.06)}
    .phonepe{background:linear-gradient(90deg,#e9ddff,#e4d4ff);color:#36084f}
    .other{background:linear-gradient(90deg,#d4ccff,#c8bbff);color:#1f1730} /* darker */

    /* carousel + static header */
    .carousel-wrap{margin-top:12px}

.carousel-header{
  padding:8px;
  border-radius:8px;
  background:linear-gradient(180deg,#f5f7fa,#ffffff);
  border:1px solid rgba(8,12,20,0.04);
  color:#475569;
  font-weight:700;
  font-size:14px;
}

.carousel{
  margin-top:8px;
  overflow:hidden;
  border-radius:8px;
  height:340px;
}

.slides{
  display:flex;
  transition:transform 0.6s ease;
  gap:0; /* remove spacing so no overlapping happens */
}

.slide{
  min-width:100%;
  flex-shrink:0;
  padding:0; /* remove padding causing the image peek */
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

.slide img{
  width:100%;
  height:340px;
  object-fit:contain; /* show FULL image inside frame */
  border-radius:8px;
}
    
    /* instructions in light shiny box (smaller text) */
    .instructions-box{margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#f8fbff,#ffffff);border:1px solid rgba(8,12,20,0.04);box-shadow:0 6px 18px rgba(11,97,255,0.03)}
    .how-title{font-weight:800;color:#111;margin-bottom:8px}
    .how-list{display:flex;flex-direction:column;gap:6px}
    .how-item{background:transparent;padding:6px;color:#475569;font-size:13px}

    /* contact */
    .contact-row{display:flex;flex-direction:column;align-items:center;gap:8px;margin-top:14px}
    .contact-btn{padding:12px 18px;border-radius:8px;background:#f3f4f6;color:#111;border:0;font-weight:800;cursor:pointer}
    .contact-small{font-size:13px;color:var(--muted);text-align:center}

    /* hidden admin trigger (invisible but clickable) */
    .admin-trigger{
      position:fixed;
      left:12px;
      bottom:12px;
      width:56px;
      height:56px;
      opacity:0;
      z-index:9999;
      border-radius:8px;
      /* ensure no visible focus or click feedback */
      outline:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      cursor: pointer;
    }

    /* simple modal/admin UI */
    .overlay{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:10000;
      background:rgba(0,0,0,0.25);
    }
    .panel{
      width:320px; max-width:90%; background:white; border-radius:12px; padding:14px; box-shadow:0 20px 60px rgba(2,6,23,0.35);
      font-family:inherit; color:#0f1724;
    }
    .panel h3{margin:0 0 8px 0; font-size:18px}
    .panel .row{display:flex;flex-direction:column; gap:8px}
    .panel input[type="text"], .panel input[type="password"]{padding:10px;border-radius:8px;border:1px solid #e6e9ef; font-weight:700}
    .panel .actions{display:flex;gap:8px; margin-top:8px}
    .btn{padding:8px 12px;border-radius:8px;border:0;font-weight:800;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,#0b61ff,#2b8bff); color:white}
    .btn.ghost{background:#f3f4f6;color:#111}

    @media (max-width:480px){
      .qr-frame{width:260px;height:260px}
      .title{font-size:22px}
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <!-- top bar in the same card -->
      <div class="topbar">
        <div class="logo">Pay</div>
        <div class="title">Pay Here</div>
      </div>

      <!-- QR area -->
      <div class="qr-wrap">
        <div class="qr-frame" id="qrframe"><img id="qrimg" src="" alt="QR image"></div>
        <div class="controls">
          <button id="downloadBtn" class="download">Download QR Code</button>
        </div>
      </div>

      <!-- UPI thin pill with copy -->
      <div class="upi-box">
        <div class="upi-pill">
          <div class="upi-text" id="upiField">merchant@upi</div>
          <button id="copyUpi" class="copy-btn">Copy</button>
        </div>
      </div>

      <!-- App buttons -->
      <div class="apps">
        <button id="btnPaytm" class="app-btn paytm">PAYTM</button>
        <button id="btnGpay" class="app-btn gpay">G PAY</button>
        <button id="btnPhonePe" class="app-btn phonepe">Phone ‡§™‡•á</button>
        <button id="btnOther" class="app-btn other">Other UPI Apps</button>
      </div>

      <!-- carousel header (static) and carousel (images move) -->
      <div class="carousel-wrap">
        <div class="carousel-header">üì≤  How to send payment Screenshot</div>
        <div class="carousel"><div class="slides" id="slides"></div></div>
      </div>

      <!-- instructions -->
      <div class="instructions-box">
        <div class="how-title">Instruction ‚ùó</div>
        <div class="how-list" id="howList"></div>
      </div>

      <!-- contact -->
      <div class="contact-row">
        <button id="contactBtn" class="contact-btn">üí¨ Contact Admin</button>
        <div class="contact-small" id="contactSmall">Sesnd Screenshot to Admin</div>
      </div>

    </div>
  </div>

  <!-- Hidden admin trigger (invisible on UI, bottom-left) -->
  <button id="adminTrigger" class="admin-trigger" aria-hidden="true"></button>

  <!-- Overlay for password prompt -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <div class="panel" id="passwordPanel" role="dialog" aria-modal="true" style="display:none;">
      <h3>Enter Admin Password</h3>
      <div class="row">
        <input id="pwdInput" type="password" placeholder="Password" autocomplete="off" />
        <div class="actions">
          <button id="pwdCancel" class="btn ghost">Cancel</button>
          <button id="pwdSubmit" class="btn primary">Enter</button>
        </div>
      </div>
    </div>

    <!-- Admin panel (simple UPI update) -->
    <div class="panel" id="adminPanel" role="dialog" aria-modal="true" style="display:none;">
      <h3>Admin ‚Äî Update UPI ID</h3>
      <div class="row">
        <input id="adminUpiInput" type="text" placeholder="merchant@upi" />
        <div class="actions">
          <button id="adminClose" class="btn ghost">Close</button>
          <button id="adminSave" class="btn primary">Save</button>
        </div>
      </div>
    </div>
  </div>

<script src="config.js"></script> <!-- small config file (see below) -->
<script>
/* ========== INITIAL CONFIG (overwritten by config.js if present) ========== */
window.CONFIG = window.CONFIG || { qr_link: "" };

/* ================= ADMIN CONFIG (initial, may be overridden by saved UPI) */
const DEFAULT_ADMIN = {
  upi: 'merchant@upi',                // default (will be replaced by saved value if present)
  payeeName: 'Merchant Name',         // <-- payee name
  contactLink: 'https://wa.me/919999999999', // <-- your WhatsApp/Telegram link
  contactText: 'Contact Admin',
  carousel: [
    // keep carousel same as before
    'https://i.ibb.co/gFPbGzZH/20251118-155331.jpg',
    'https://i.ibb.co/TBTd5S3p/20251118-160648.jpg',
    'https://i.ibb.co/fVJnf9V7/20251118-153613.jpg'
  ],
  instructions: [
    'Open any UPI app or scan the QR with your UPI app.',
    'Confirm the UPI ID and payee name before approving.',
    'Enter the exact amount in your UPI app (do not rely on defaults).',
    'After payment, take a screenshot and send it to admin for confirmation.'
  ]
};
/* ======================================================================== */

/* Load saved UPI from localStorage if exists */
const SAVED_UPI_KEY = 'admin_upi';
const savedUpi = localStorage.getItem(SAVED_UPI_KEY);
const ADMIN = Object.assign({}, DEFAULT_ADMIN);
if (savedUpi) ADMIN.upi = savedUpi;

/* DOM elements */
const upiField = document.getElementById('upiField');
const qrImg = document.getElementById('qrimg');
const downloadBtn = document.getElementById('downloadBtn');
const slidesEl = document.getElementById('slides');
const howList = document.getElementById('howList');
const contactBtn = document.getElementById('contactBtn');

/* set UI initial text */
upiField.textContent = ADMIN.upi;
contactBtn.textContent = (ADMIN.contactText || 'Contact Admin') + '  üí¨';

/* Build UPI URI */
function buildUpiUri(){
  const params = new URLSearchParams({pa:ADMIN.upi,pn:ADMIN.payeeName,cu:'INR'});
  return 'upi://pay?' + params.toString();
}

/* Choose QR source: if CONFIG.qr_link provided use it, else use google chart with upi uri */
function initialQrSrc(){
  if(window.CONFIG && window.CONFIG.qr_link && window.CONFIG.qr_link.trim() !== ""){
    return window.CONFIG.qr_link;
  }
  const uri = buildUpiUri();
  return `https://chart.googleapis.com/chart?cht=qr&chs=1000x1000&chl=${encodeURIComponent(uri)}`;
}

/* Set qr src initially (and after upi change we refresh) */
function refreshQr(){
  // use CONFIG.qr_link if set, otherwise regenerate google chart
  const src = initialQrSrc();
  qrImg.src = src;
}
refreshQr();

/* Populate carousel images */
ADMIN.carousel.forEach(url => {
  const s = document.createElement('div'); s.className = 'slide';
  const img = document.createElement('img'); img.src = url; img.alt = 'step';
  s.appendChild(img); slidesEl.appendChild(s);
});
let cIndex = 0;
function showSlide(i){ slidesEl.style.transform = `translateX(-${i*100}%)`; }
setInterval(()=>{ cIndex = (cIndex+1) % ADMIN.carousel.length; showSlide(cIndex); }, 2200);

/* Populate instructions (smaller text) */
howList.innerHTML = '';
ADMIN.instructions.forEach(line => {
  const d = document.createElement('div'); d.className = 'how-item'; d.textContent = line; howList.appendChild(d);
});

/* Download QR: same logic as before */
async function downloadQr(){
  try{
    const src = qrImg.src;
    const resp = await fetch(src, {mode:'cors'});
    if(!resp.ok) throw new Error('Network response not ok');
    const blob = await resp.blob();
    triggerDownload(blob, 'upi-qr-' + Date.now() + '.png');
    showToast('QR downloaded to device');
  }catch(err){
    console.warn('Download failed, fallback to open', err);
    window.open(qrImg.src, '_blank');
    showToast('Could not download directly ‚Äî opened image to save manually');
  }
}
function triggerDownload(blob, filename){
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}
downloadBtn.addEventListener('click', downloadQr);

/* Copy UPI to clipboard */
document.getElementById('copyUpi').addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(ADMIN.upi);
    showToast('UPI copied to clipboard');
  }catch(e){
    const t = document.createElement('textarea'); t.value = ADMIN.upi; document.body.appendChild(t); t.select();
    document.execCommand('copy'); t.remove();
    showToast('UPI copied to clipboard');
  }
});

/* App openers (no amount passed) */
const PACK = { gpay:'com.google.android.apps.nbu.paisa.user', phonepe:'com.phonepe.app', paytm:'net.one97.paytm' };
function openChain(pref){
  const query = new URLSearchParams({pa:ADMIN.upi,pn:ADMIN.payeeName,cu:'INR'}).toString();
  const generic = 'upi://pay?' + query;
  const ua = navigator.userAgent || '';
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  if(isAndroid){
    let i = 0;
    function next(){
      if(i >= pref.length){ window.location.href = generic; return; }
      const key = pref[i++]; const pkg = PACK[key];
      if(!pkg){ next(); return; }
      const intent = `intent://pay?${query}#Intent;scheme=upi;package=${pkg};end`;
      window.location.href = intent;
      setTimeout(next, 1200);
    }
    next();
  } else if(isIOS){
    window.location.href = generic;
  } else {
    alert('Open this page on a mobile device to complete the UPI payment.');
  }
}
document.getElementById('btnPaytm').addEventListener('click', ()=>openChain(['paytm','phonepe','gpay']));
document.getElementById('btnGpay').addEventListener('click', ()=>openChain(['gpay','phonepe','paytm']));
document.getElementById('btnPhonePe').addEventListener('click', ()=>openChain(['phonepe','paytm','gpay']));
document.getElementById('btnOther').addEventListener('click', ()=>{ window.location.href = 'upi://pay?pa='+encodeURIComponent(ADMIN.upi)+'&pn='+encodeURIComponent(ADMIN.payeeName)+'&cu=INR'; });

/* Contact */
contactBtn.addEventListener('click', ()=> window.open(ADMIN.contactLink, '_blank'));

/* small toast */
function showToast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed'; t.style.left='50%'; t.style.bottom='22px'; t.style.transform='translateX(-50%)';
  t.style.background='rgba(11,97,255,0.95)'; t.style.color='#fff'; t.style.padding='8px 12px';
  t.style.borderRadius='8px'; t.style.boxShadow='0 8px 20px rgba(11,97,255,0.12)'; t.style.zIndex=9999;
  document.body.appendChild(t);
  setTimeout(()=>t.style.opacity='0.01',1500); setTimeout(()=>t.remove(),2000);
}

/* fallback if QR fails to load */
qrImg.addEventListener('error', ()=>{ qrImg.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="20">QR Unavailable</text></svg>'; });

/* =================== HIDDEN ADMIN TRIGGER & PANEL LOGIC =================== */
/*
 Behavior implemented:
 - Hidden clickable area bottom-left (no visual feedback).
 - Each click increments a counter; when count reaches 10, show password prompt.
 - If clicks < 10: clicking toggles a transient admin overlay (2s visible). After 2s, if password input not focused, starts a 5s auto-close. If user focuses input (starts typing) the auto-close is canceled.
 - Clicking trigger while overlay is open closes it immediately.
 - Password is "fassvord". If correct, admin panel (UPI edit) opens. Save persists UPI in localStorage and updates UI (and QR behavior).
*/

const adminTrigger = document.getElementById('adminTrigger');
const overlay = document.getElementById('overlay');
const passwordPanel = document.getElementById('passwordPanel');
const pwdInput = document.getElementById('pwdInput');
const pwdCancel = document.getElementById('pwdCancel');
const pwdSubmit = document.getElementById('pwdSubmit');

const adminPanel = document.getElementById('adminPanel');
const adminUpiInput = document.getElementById('adminUpiInput');
const adminSave = document.getElementById('adminSave');
const adminClose = document.getElementById('adminClose');

let clickCount = 0;
let transientTimer = null;
let autoCloseTimer = null;
let transientShown = false; // whether transient overlay/panel is shown

function showTransientOverlay(durationMs = 2000){
  // Show a minimal overlay (password panel) but not asking for password yet.
  overlay.style.display = 'flex';
  passwordPanel.style.display = 'block';
  adminPanel.style.display = 'none';
  passwordPanel.querySelector('h3').textContent = 'Admin Preview';
  pwdInput.value = '';
  pwdInput.placeholder = 'Tap 10 times to open password';
  pwdInput.disabled = true;
  overlay.setAttribute('aria-hidden', 'false');
  passwordPanel.setAttribute('aria-hidden', 'false');
  transientShown = true;

  clearTimeout(transientTimer);
  clearTimeout(autoCloseTimer);

  // After durationMs (2s), allow main password prompt UI (but do not automatically open full admin).
  transientTimer = setTimeout(()=>{
    // change to actual password prompt but do not auto-focus (user must click or type)
    pwdInput.disabled = false;
    pwdInput.placeholder = 'Password';
    pwdInput.value = '';
    passwordPanel.querySelector('h3').textContent = 'Enter Admin Password';
    // start a 5s auto-close if no typing detected
    startAutoCloseIfNoTyping(5000);
  }, durationMs);
}

function hideOverlayImmediately(){
  clearTimeout(transientTimer);
  clearTimeout(autoCloseTimer);
  overlay.style.display = 'none';
  passwordPanel.style.display = 'none';
  adminPanel.style.display = 'none';
  overlay.setAttribute('aria-hidden', 'true');
  transientShown = false;
}

// auto-close logic (5s) unless user focuses password input (typing)
function startAutoCloseIfNoTyping(timeoutMs = 5000){
  clearTimeout(autoCloseTimer);
  autoCloseTimer = setTimeout(()=>{
    // if admin panel not open and pwd input not focused, close
    if(document.activeElement !== pwdInput && document.activeElement !== adminUpiInput){
      hideOverlayImmediately();
    }
  }, timeoutMs);
}

/* clicking the invisible trigger increments count and toggles transient view */
adminTrigger.addEventListener('click', (e) => {
  // prevent any visible click effects
  e.preventDefault();
  e.stopPropagation();

  clickCount++;
  // If overlay open and user clicks trigger, close immediately
  if(overlay.style.display === 'flex'){
    hideOverlayImmediately();
    return;
  }

  // If clickCount reached 10, show password prompt overlay immediately
  if(clickCount >= 10){
    openPasswordPrompt();
    clickCount = 0; // reset
    return;
  }

  // Otherwise show transient overlay for 2 seconds (then enable password entry & auto-close)
  showTransientOverlay(2000);
});

/* open actual password prompt (non-transient) */
function openPasswordPrompt(){
  overlay.style.display = 'flex';
  passwordPanel.style.display = 'block';
  adminPanel.style.display = 'none';
  passwordPanel.querySelector('h3').textContent = 'Enter Admin Password';
  pwdInput.disabled = false;
  pwdInput.placeholder = 'Password';
  pwdInput.value = '';
  pwdInput.focus();
  overlay.setAttribute('aria-hidden', 'false');
  transientShown = true;
  clearTimeout(transientTimer);
  clearTimeout(autoCloseTimer);
  // If user doesn't type within 5s, close
  startAutoCloseIfNoTyping(5000);
}

/* password cancel/submit logic */
pwdCancel.addEventListener('click', ()=>{
  hideOverlayImmediately();
});
pwdSubmit.addEventListener('click', ()=> attemptPassword());
pwdInput.addEventListener('keydown', (ev) => {
  // once user starts typing, cancel auto close
  clearTimeout(autoCloseTimer);
  if(ev.key === 'Enter') attemptPassword();
});

function attemptPassword(){
  const val = (pwdInput.value || '').trim();
  // check password
  if(val === 'fassvord'){
    openAdminPanel();
  } else {
    showToast('Wrong password');
    pwdInput.value = '';
    pwdInput.focus();
  }
}

/* Admin panel open (simple UPI edit). If admin panel is already open, close. */
function openAdminPanel(){
  overlay.style.display = 'flex';
  adminPanel.style.display = 'block';
  passwordPanel.style.display = 'none';
  adminUpiInput.value = ADMIN.upi || '';
  adminUpiInput.focus();
  overlay.setAttribute('aria-hidden', 'false');
  clearTimeout(transientTimer);
  clearTimeout(autoCloseTimer);
  transientShown = true;
}

/* admin close/save */
adminClose.addEventListener('click', ()=> { hideOverlayImmediately(); });
adminSave.addEventListener('click', ()=>{
  const newUpi = (adminUpiInput.value || '').trim();
  if(!newUpi){
    showToast('Enter a valid UPI ID');
    return;
  }
  ADMIN.upi = newUpi;
  // persist
  try{ localStorage.setItem(SAVED_UPI_KEY, newUpi); }catch(e){}
  // update UI
  upiField.textContent = ADMIN.upi;
  refreshQr();
  showToast('UPI updated');
  hideOverlayImmediately();
});

/* If adminUpiInput focused/typing, cancel auto-close */
adminUpiInput.addEventListener('focus', ()=> { clearTimeout(autoCloseTimer); });
adminUpiInput.addEventListener('input', ()=> { clearTimeout(autoCloseTimer); });

/* Small accessibility: close overlay if clicking outside panels */
overlay.addEventListener('click', (ev)=>{
  if(ev.target === overlay){
    hideOverlayImmediately();
  }
});

/* reset clickCount if no interactions for a while (optional) */
setInterval(()=>{ if(clickCount>0) clickCount = Math.max(0, clickCount - 1); }, 60000);

/* ======================================================================== */

</script>
</body>
</html>
