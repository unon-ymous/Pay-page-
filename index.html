<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pay Here ‚Äî UPI Payment</title>
  <style>
    :root{
      --page-bg:#eef6fb;
      --panel:#ffffff;
      --muted:#6b7280;
      --accent:#0b61ff;
      --radius:12px;
      --shadow:0 10px 30px rgba(12,20,40,0.06);
      --light-gray:#f3f4f6;
      --copy-gray:#eef2f6;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--page-bg);color:#0f1724}

    /* container */
    .page{max-width:760px;margin:18px auto;padding:0 12px}
    .card{background:linear-gradient(180deg,#f8fcff,#ffffff);border-radius:16px;padding:14px;box-shadow:var(--shadow);overflow:hidden}

    /* topbar */
    .topbar{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg,#e6f5ff,#dff2ff)}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#0b61ff,#33a1ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
    .title{font-size:26px;font-style:italic;color:#08324a;font-weight:800;letter-spacing:0.3px}

    /* QR area */
    .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px}
    .qr-frame{width:320px;height:320px;border-radius:12px;border:1px dashed rgba(8,12,20,0.06);overflow:hidden;background:#fff;display:grid;place-items:center}
    .qr-frame img{width:100%;height:100%;object-fit:cover;display:block}
    .controls{display:flex;gap:10px;align-items:center;width:92%}
    .download{flex:1;padding:12px;border-radius:18px;background:linear-gradient(90deg,#dff7e1,#c6f0c9);border:1px solid rgba(10,91,46,0.08);font-weight:700;cursor:pointer}

    /* UPI single thin box with copy inside */
    .upi-box{margin-top:10px;display:flex;align-items:center;gap:8px;width:92%}
    .upi-pill{flex:1;display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;background:#fafcff;border:1px solid rgba(8,12,20,0.06);font-weight:700}
    .upi-text{font-size:15px;color:#0b1f2f}
    .copy-btn{padding:6px 10px;border-radius:8px;background:var(--copy-gray);color:#425066;border:0;cursor:pointer;font-weight:700}

    /* apps */
    .apps{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .app-btn{padding:12px;border-radius:10px;border:0;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .paytm{background:linear-gradient(90deg,#e6f0ff,#cfe6ff);color:#003366}
    .gpay{background:linear-gradient(90deg,#fff,#fff7ed);color:#111;border:1px solid rgba(0,0,0,0.06)}
    .phonepe{background:linear-gradient(90deg,#f3e9ff,#efe2ff);color:#3a0b66}
    .other{background:linear-gradient(90deg,#dcd6ff,#cfc6ff);color:#221f3a} /* darker */

    /* carousel + static header */
    .carousel-wrap{margin-top:12px}

.carousel-header{
  padding:8px;
  border-radius:8px;
  background:linear-gradient(180deg,#f5f7fa,#ffffff);
  border:1px solid rgba(8,12,20,0.04);
  color:#475569;
  font-weight:700;
  font-size:14px;
}

.carousel{
  margin-top:8px;
  overflow:hidden;
  border-radius:8px;
  height:340px;
}

.slides{
  display:flex;
  transition:transform 0.6s ease;
  gap:0; /* remove spacing so no overlapping happens */
}

.slide{
  min-width:100%;
  flex-shrink:0;
  padding:0; /* remove padding causing the image peek */
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

.slide img{
  width:100%;
  height:340px;
  object-fit:contain; /* show FULL image inside frame */
  border-radius:8px;
}
    
    /* instructions in light shiny box (smaller text) */
    .instructions-box{margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#f8fbff,#ffffff);border:1px solid rgba(8,12,20,0.04);box-shadow:0 6px 18px rgba(11,97,255,0.03)}
    .how-title{font-weight:800;color:#111;margin-bottom:8px}
    .how-list{display:flex;flex-direction:column;gap:6px}
    .how-item{background:transparent;padding:6px;color:#475569;font-size:13px}

    /* contact */
    .contact-row{display:flex;flex-direction:column;align-items:center;gap:8px;margin-top:14px}
    .contact-btn{padding:12px 18px;border-radius:8px;background:#f3f4f6;color:#111;border:0;font-weight:800;cursor:pointer}
    .contact-small{font-size:13px;color:var(--muted);text-align:center}

    @media (max-width:480px){
      .qr-frame{width:260px;height:260px}
      .title{font-size:22px}
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <!-- top bar in the same card -->
      <div class="topbar">
        <div class="logo">Pay</div>
        <div class="title">Pay Here</div>
      </div>

      <!-- QR area -->
      <div class="qr-wrap">
        <div class="qr-frame" id="qrframe"><img id="qrimg" src="" alt="QR image"></div>
        <div class="controls">
          <button id="downloadBtn" class="download">Download QR Code</button>
        </div>
      </div>

      <!-- UPI thin pill with copy -->
      <div class="upi-box">
        <div class="upi-pill">
          <div class="upi-text" id="upiField">merchant@upi</div>
          <button id="copyUpi" class="copy-btn">Copy</button>
        </div>
      </div>

      <!-- App buttons -->
      <div class="apps">
        <button id="btnPaytm" class="app-btn paytm">PAYTM</button>
        <button id="btnGpay" class="app-btn gpay">G PAY</button>
        <button id="btnPhonePe" class="app-btn phonepe">Phone ‡§™‡•á</button>
        <button id="btnOther" class="app-btn other">Other UPI Apps</button>
      </div>

      <!-- carousel header (static) and carousel (images move) -->
      <div class="carousel-wrap">
        <div class="carousel-header">üì≤  How to send payment Screenshot</div>
        <div class="carousel"><div class="slides" id="slides"></div></div>
      </div>

      <!-- instructions -->
      <div class="instructions-box">
        <div class="how-title">Instruction ‚ùó</div>
        <div class="how-list" id="howList"></div>
      </div>

      <!-- contact -->
      <div class="contact-row">
        <button id="contactBtn" class="contact-btn">üí¨ Contact Admin</button>
        <div class="contact-small" id="contactSmall">Sesnd Screenshot to Admin</div>
      </div>

    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function () {

    // ---------- CONFIG ----------
    // OPTIONAL: set RAW_CONFIG_URL to the raw.githubusercontent.com URL of your config.js
    // Example: "https://raw.githubusercontent.com/<username>/<repo>/<branch>/config.js"
    // If you leave it blank, the page will poll the site-relative /config.js file.
    const RAW_CONFIG_URL = ""; // <-- OPTIONAL: set this once for GitHub repo raw URL (one-time change)

    // Poll interval in ms (1 second gives near-instant updates)
    const POLL_INTERVAL_MS = 1000;

    // localStorage key used to persist the latest config on the client
    const LS_KEY = 'PAY_CONFIG_CACHE_V1';

    // Default ADMIN object (UI unchanged)
    const ADMIN = {
      upi: 'merchant@upi',
      payeeName: 'Merchant Name',
      contactLink: 'https://wa.me/919999999999',
      contactText: 'Contact Admin',
      carousel: [
        'https://i.ibb.co/gFPbGzZH/20251118-155331.jpg',
        'https://i.ibb.co/TBTd5S3p/20251118-160648.jpg',
        'https://i.ibb.co/fVJnf9V7/20251118-153613.jpg'
      ],
      instructions: [
        'Open any UPI app or scan the QR with your UPI app.',
        'Confirm the UPI ID and payee name before approving.',
        'Enter the exact amount in your UPI app (do not rely on defaults).',
        'After payment, take a screenshot and send it to admin for confirmation.'
      ]
    };

    // ---------- helper to parse config.js text safely (no executing) ----------
    function parseConfigJsText(txt){
      const qMatch = txt.match(/Qrlink\s*:\s*["']([^"']*)["']/);
      const uMatch = txt.match(/Upiid\s*:\s*["']([^"']*)["']/);
      return {
        Qrlink: qMatch ? qMatch[1] : '',
        Upiid: uMatch ? uMatch[1] : ''
      };
    }

    // ---------- localStorage helpers ----------
    function readCachedConfig(){
      try{
        const s = localStorage.getItem(LS_KEY);
        if(!s) return null;
        const obj = JSON.parse(s);
        if(obj && typeof obj === 'object') return obj;
      }catch(e){ /* ignore */ }
      return null;
    }
    function saveCachedConfig(parsed){
      try{
        localStorage.setItem(LS_KEY, JSON.stringify(parsed || {}));
      }catch(e){ /* ignore */ }
    }

    // Fetch config with cache-busting. Try RAW_CONFIG_URL first (if set), then site-relative /config.js
    async function fetchConfigText(){
      const candidates = [];
      if(RAW_CONFIG_URL && RAW_CONFIG_URL.trim() !== "") {
        candidates.push(RAW_CONFIG_URL + '?cb=' + Date.now());
      }
      // site-relative config (same origin as page)
      candidates.push(window.location.origin + '/config.js?cb=' + Date.now());
      for(const url of candidates){
        try{
          const res = await fetch(url, { cache: 'no-store' });
          if(!res.ok) continue;
          const txt = await res.text();
          if(txt && txt.trim().length > 0) return { raw: txt, url };
        }catch(e){
          // try next candidate
        }
      }
      return null;
    }

    // Apply parsed config to ADMIN and UI immediately
    function applyParsedConfig(parsed){
      let changed = false;
      if(parsed.Upiid && parsed.Upiid.trim() !== '' && ADMIN.upi !== parsed.Upiid.trim()){
        ADMIN.upi = parsed.Upiid.trim();
        const upiField = document.getElementById('upiField');
        if(upiField) upiField.textContent = ADMIN.upi;
        changed = true;
      }
      if(typeof parsed.Qrlink === 'string'){
        const newQ = parsed.Qrlink.trim();
        const qrEl = document.getElementById('qrimg');
        if(qrEl){
          const newSrc = newQ !== '' ? newQ : generateQrFromUpi();
          // Compare full URL form; assign if different
          if(qrEl.src !== newSrc){
            qrEl.src = newSrc;
            changed = true;
          }
        }
      }
      return changed;
    }

    function generateQrFromUpi(){
      const uri = 'upi://pay?' + new URLSearchParams({pa:ADMIN.upi,pn:ADMIN.payeeName,cu:'INR'}).toString();
      return `https://chart.googleapis.com/chart?cht=qr&chs=1000x1000&chl=${encodeURIComponent(uri)}`;
    }

    // ---------- initialize carousel and instructions (unchanged UI) ----------
    const slidesEl = document.getElementById('slides');
    const howList = document.getElementById('howList');

    function initCarouselAndInstructions(){
      slidesEl.innerHTML = '';
      ADMIN.carousel.forEach(url => {
        const s = document.createElement('div'); s.className = 'slide';
        const img = document.createElement('img'); img.src = url; img.alt = 'step';
        s.appendChild(img); slidesEl.appendChild(s);
      });
      let cIndex = 0;
      function showSlide(i){ slidesEl.style.transform = `translateX(-${i*100}%)`; }
      if (slidesEl.children.length > 1) {
        setInterval(()=>{ cIndex = (cIndex+1) % slidesEl.children.length; showSlide(cIndex); }, 2200);
      }
      howList.innerHTML = '';
      ADMIN.instructions.forEach(line => {
        const d = document.createElement('div'); d.className = 'how-item'; d.textContent = line; howList.appendChild(d);
      });
    }
    initCarouselAndInstructions();

    // ---------- buttons and behavior (unchanged UX) ----------
    (function setupButtons(){
      const qrEl = document.getElementById('qrimg');
      const downloadBtn = document.getElementById('downloadBtn');
      if(downloadBtn){
        downloadBtn.addEventListener('click', async ()=>{
          try{
            const src = qrEl.src;
            const resp = await fetch(src, { mode: 'cors' });
            if(!resp.ok) throw new Error('Network response not ok');
            const blob = await resp.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'upi-qr-' + Date.now() + '.png'; document.body.appendChild(a); a.click(); a.remove();
            URL.revokeObjectURL(url);
            showToast('QR downloaded to device');
            return;
          }catch(err){
            // fallback attempts
            try{
              const a2 = document.createElement('a');
              a2.href = qrEl.src;
              a2.target = '_blank';
              a2.download = 'upi-qr-' + Date.now() + '.png';
              document.body.appendChild(a2); a2.click(); a2.remove();
              showToast('If download blocked, image opened in new tab ‚Äî save manually');
            }catch(e){
              window.open(qrEl.src, '_blank');
              showToast('Could not download ‚Äî opened image to save manually');
            }
          }
        });
      }

      const copyBtn = document.getElementById('copyUpi');
      if(copyBtn){
        copyBtn.addEventListener('click', async ()=>{
          try{
            await navigator.clipboard.writeText(ADMIN.upi);
            showToast('UPI copied to clipboard');
          }catch(e){
            const t = document.createElement('textarea'); t.value = ADMIN.upi; document.body.appendChild(t); t.select();
            document.execCommand('copy'); t.remove();
            showToast('UPI copied to clipboard');
          }
        });
      }

      const PACK = { gpay:'com.google.android.apps.nbu.paisa.user', phonepe:'com.phonepe.app', paytm:'net.one97.paytm' };
      function openChain(pref){
        const query = new URLSearchParams({pa:ADMIN.upi,pn:ADMIN.payeeName,cu:'INR'}).toString();
        const generic = 'upi://pay?' + query;
        const ua = navigator.userAgent || '';
        const isAndroid = /Android/i.test(ua);
        const isIOS = /iPhone|iPad|iPod/i.test(ua);
        if(isAndroid){
          let i = 0;
          function next(){
            if(i >= pref.length){ window.location.href = generic; return; }
            const key = pref[i++]; const pkg = PACK[key];
            if(!pkg){ next(); return; }
            const intent = `intent://pay?${query}#Intent;scheme=upi;package=${pkg};end`;
            window.location.href = intent;
            setTimeout(next, 1200);
          }
          next();
        } else if(isIOS){
          window.location.href = generic;
        } else {
          alert('Open this page on a mobile device to complete the UPI payment.');
        }
      }

      const btnPaytm = document.getElementById('btnPaytm');
      const btnGpay = document.getElementById('btnGpay');
      const btnPhonePe = document.getElementById('btnPhonePe');
      const btnOther = document.getElementById('btnOther');
      if(btnPaytm) btnPaytm.addEventListener('click', ()=>openChain(['paytm','phonepe','gpay']));
      if(btnGpay) btnGpay.addEventListener('click', ()=>openChain(['gpay','phonepe','paytm']));
      if(btnPhonePe) btnPhonePe.addEventListener('click', ()=>openChain(['phonepe','paytm','gpay']));
      if(btnOther) btnOther.addEventListener('click', ()=>{ window.location.href = 'upi://pay?pa='+encodeURIComponent(ADMIN.upi)+'&pn='+encodeURIComponent(ADMIN.payeeName)+'&cu=INR'; });

      const contactBtn = document.getElementById('contactBtn');
      if(contactBtn) contactBtn.addEventListener('click', ()=> window.open(ADMIN.contactLink, '_blank'));
    })();

    // toast helper
    function showToast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position='fixed'; t.style.left='50%'; t.style.bottom='22px'; t.style.transform='translateX(-50%)';
      t.style.background='rgba(11,97,255,0.95)'; t.style.color='#fff'; t.style.padding='8px 12px';
      t.style.borderRadius='8px'; t.style.boxShadow='0 8px 20px rgba(11,97,255,0.12)'; t.style.zIndex=9999;
      document.body.appendChild(t);
      setTimeout(()=>t.style.opacity='0.01',1500); setTimeout(()=>t.remove(),2000);
    }

    // QR fallback
    const qrEl = document.getElementById('qrimg');
    if(qrEl){
      qrEl.addEventListener('error', ()=>{ qrEl.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="20">QR Unavailable</text></svg>'; });
    }

    // ---------- caching + polling logic ----------
    // 1) On load, apply cached config (if any) for instant display.
    // 2) Fetch server config; if different, apply and overwrite cache.
    // 3) Poll server every POLL_INTERVAL_MS to detect updates and apply + cache.

    function applyCachedOrDefault(){
      const cached = readCachedConfig();
      if(cached && (cached.Qrlink !== undefined || cached.Upiid !== undefined)){
        const parsed = { Qrlink: cached.Qrlink || '', Upiid: cached.Upiid || '' };
        applyParsedConfig(parsed); // apply parsed (updates UI)
      } else {
        // no cached config ‚Äî use default ADMIN to generate QR
        const upiField = document.getElementById('upiField');
        if(upiField) upiField.textContent = ADMIN.upi;
        if(qrEl) qrEl.src = generateQrFromUpi();
      }
    }

    // read cached config from localStorage
    function readCachedConfig(){
      try{
        const s = localStorage.getItem(LS_KEY);
        if(!s) return null;
        return JSON.parse(s);
      }catch(e){ return null; }
    }
    // save cached config to localStorage
    function writeCachedConfig(parsed){
      try{ localStorage.setItem(LS_KEY, JSON.stringify(parsed || {})); }catch(e){}
    }

    let lastRaw = null;
    async function pollOnce(){
      const got = await fetchConfigText();
      if(!got) return;
      if(lastRaw === null || got.raw !== lastRaw){
        lastRaw = got.raw;
        const parsed = parseConfigJsText(got.raw);
        // apply parsed config
        applyParsedConfig(parsed);
        // persist parsed into localStorage for survival across refresh
        writeCachedConfig(parsed);
        showToast('Config updated');
      }
    }

    // initial instant apply from cache
    applyCachedOrDefault();

    // fetch now and then poll
    (async function initialFetchThenPoll(){
      await pollOnce(); // immediate attempt
      setInterval(pollOnce, POLL_INTERVAL_MS);
    })();

  });
  </script>

</body>
</html>
