<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pay Here ‚Äî UPI Payment</title>
  <style>
    :root{
      --page-bg:#eef6fb;
      --panel:#ffffff;
      --muted:#6b7280;
      --accent:#0b61ff;
      --radius:12px;
      --shadow:0 10px 30px rgba(12,20,40,0.06);
      --light-gray:#f3f4f6;
      --copy-gray:#eef2f6;
      --btn-darken: 0.92; /* multiply to make bg slightly darker visually */
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--page-bg);color:#0f1724}

    /* container */
    .page{max-width:760px;margin:18px auto;padding:0 12px}
    .card{background:linear-gradient(180deg,#f8fcff,#ffffff);border-radius:16px;padding:14px;box-shadow:var(--shadow);overflow:hidden}

    /* topbar */
    .topbar{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg,#e6f5ff,#dff2ff)}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#0b61ff,#33a1ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
    .title{font-size:26px;font-style:italic;color:#08324a;font-weight:800;letter-spacing:0.3px}

    /* QR area */
    .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px}
    .qr-frame{width:320px;height:320px;border-radius:12px;border:1px dashed rgba(8,12,20,0.06);overflow:hidden;background:#fff;display:grid;place-items:center}
    .qr-frame img{width:100%;height:100%;object-fit:cover;display:block}
    .controls{display:flex;gap:10px;align-items:center;width:92%}
    .download{flex:1;padding:12px;border-radius:18px;background:linear-gradient(90deg,#dff7e1,#c6f0c9);border:1px solid rgba(10,91,46,0.08);font-weight:700;cursor:pointer}

    /* UPI single thin box with copy inside */
    .upi-box{margin-top:10px;display:flex;align-items:center;gap:8px;width:92%}
    .upi-pill{flex:1;display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;background:#fafcff;border:1px solid rgba(8,12,20,0.06);font-weight:700}
    .upi-text{font-size:15px;color:#0b1f2f}
    .copy-btn{padding:6px 10px;border-radius:8px;background:var(--copy-gray);color:#425066;border:0;cursor:pointer;font-weight:700}

    /* apps */
    .apps{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .app-btn{padding:12px;border-radius:10px;border:0;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
    /* Slightly darker variants */
    .paytm{background:linear-gradient(90deg,#dfe9ff,#cfe0ff);color:#003366}
    .gpay{background:linear-gradient(90deg,#f8f8f8,#fff3e6);color:#111;border:1px solid rgba(0,0,0,0.06)}
    .phonepe{background:linear-gradient(90deg,#eadcff,#e6dbff);color:#3a0b66}
    .other{background:linear-gradient(90deg,#f0f0f0,#ececec);color:#121212;border:1px solid rgba(0,0,0,0.04)}

    /* icon wrapper to keep logos consistent */
    .app-icon{width:20px;height:20px;display:inline-block;vertical-align:middle}

    /* carousel + static header */
    .carousel-wrap{margin-top:12px}
    .carousel-header{
      padding:8px;
      border-radius:8px;
      background:linear-gradient(180deg,#f5f7fa,#ffffff);
      border:1px solid rgba(8,12,20,0.04);
      color:#475569;
      font-weight:700;
      font-size:14px;
    }

    .carousel{
      margin-top:8px;
      overflow:hidden;
      border-radius:8px;
      height:340px;
      position:relative;
    }

    .slides{
      display:flex;
      transition:transform 0.6s ease;
      gap:0;
      height:100%;
      width:100%;
    }

    .slide{
      min-width:100%;
      flex-shrink:0;
      padding:0;
      height:100%;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .slide img{
      width:100%;
      height:340px;
      object-fit:contain;
      border-radius:8px;
    }

    .carousel-empty{
      display:flex;
      align-items:center;
      justify-content:center;
      height:100%;
      color:#94a3b8;
      font-weight:600;
      background:linear-gradient(180deg,#fff,#fbfdff);
      border-radius:8px;
    }

    /* instructions in light shiny box (smaller text) */
    .instructions-box{margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#f8fbff,#ffffff);border:1px solid rgba(8,12,20,0.04);box-shadow:0 6px 18px rgba(11,97,255,0.03)}
    .how-title{font-weight:800;color:#111;margin-bottom:8px}
    .how-list{display:flex;flex-direction:column;gap:6px}
    .how-item{background:transparent;padding:6px;color:#475569;font-size:13px}

    /* contact */
    .contact-row{display:flex;flex-direction:column;align-items:center;gap:8px;margin-top:14px}
    .contact-btn{padding:12px 18px;border-radius:8px;background:#f3f4f6;color:#111;border:0;font-weight:800;cursor:pointer}
    .contact-small{font-size:13px;color:var(--muted);text-align:center}

    @media (max-width:480px){
      .qr-frame{width:260px;height:260px}
      .title{font-size:22px}
    }

    .disabled { opacity: 0.5; pointer-events: none; }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <!-- top bar in the same card -->
      <div class="topbar">
        <div class="logo">Pay</div>
        <div class="title">Pay Here</div>
      </div>

      <!-- QR area -->
      <div class="qr-wrap">
        <div class="qr-frame" id="qrframe"><img id="qrimg" src="" alt="QR image"></div>
        <div class="controls">
          <button id="downloadBtn" class="download">Download QR Code</button>
        </div>
      </div>

      <!-- UPI thin pill with copy -->
      <div class="upi-box">
        <div class="upi-pill">
          <div class="upi-text" id="upiField"></div>
          <button id="copyUpi" class="copy-btn">Copy</button>
        </div>
      </div>

      <!-- App buttons (text + inline logo on right) -->
      <div class="apps">
        <button id="btnPaytm" class="app-btn paytm">
          PAYTM
          <!-- paytm-like mark (stylized P) -->
          <span class="app-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg" role="img">
              <rect x="1.5" y="4" width="21" height="16" rx="3" fill="#0A5EFF"/>
              <path d="M7 15.2h1.8v-6.4H7V15.2zM10.2 10.6c0 1.3 1.1 2 2.6 2 1.4 0 2.5-0.7 2.5-2V9.2H12.1v1.4c0 .4-.2.6-.5.6-.3 0-.5-.2-.5-.6V7.6H10V10.6z" fill="#fff"/>
            </svg>
          </span>
        </button>

        <button id="btnGpay" class="app-btn gpay">
          G PAY
          <!-- simplified GPay-style mark -->
          <span class="app-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img">
              <path d="M12 7v3h5.5c-.2-1.1-1-2.1-2.5-2.9L12 7z" fill="#4285F4"/>
              <path d="M7 12c0-.3.1-.6.2-.9L7 9l-3 2.5 3 2.5.2-1.6c-.1-.5-.2-1-.2-1.5z" fill="#EA4335"/>
              <path d="M12 17c1.4 0 2.6-.5 3.6-1.3l-1.8-1.4C13.9 15 13 15.4 12 15.4c-2.3 0-4.2-1.2-5.2-3l-1.9 1.5C6 16 8.8 17 12 17z" fill="#34A853"/>
              <path d="M17.6 5.9C16.3 4.8 14.3 4 12 4 8.8 4 6 5 4.1 7.3L6.3 9c1-1.5 2.9-2.5 5.7-2.5 1.5 0 2.8.3 3.9.9l2-1.7z" fill="#FBBC05"/>
            </svg>
          </span>
        </button>

        <button id="btnPhonePe" class="app-btn phonepe">
          Phone ‡§™‡•á
          <!-- phonepe-like mark -->
          <span class="app-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img">
              <rect x="2" y="2" width="20" height="20" rx="4" fill="#6C3CE5"/>
              <path d="M8 15.5h1.5V8H8v7.5zm3.2 0h1.5V10.2c0-1 .5-1.6 1.5-1.6 1 0 1.3.6 1.3 1.5v5.4H17V10c0-2-1.3-3-3.3-3-2 0-3 1-3 3v5.5z" fill="#fff"/>
            </svg>
          </span>
        </button>

        <button id="btnOther" class="app-btn other">
          Other UPI
          <!-- neutral UPI mark -->
          <span class="app-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img">
              <rect x="1.5" y="3" width="21" height="18" rx="3" fill="#E6E6E6"/>
              <path d="M6 12h12v2H6z" fill="#9CA3AF"/>
            </svg>
          </span>
        </button>
      </div>

      <!-- carousel header (static) and carousel (images move) -->
      <div class="carousel-wrap">
        <div class="carousel-header">üì≤  How to send payment Screenshot</div>
        <div class="carousel" id="carouselRoot">
          <div class="slides" id="slides"></div>
        </div>
      </div>

      <!-- instructions -->
      <div class="instructions-box">
        <div class="how-title">Instruction ‚ùó</div>
        <div class="how-list" id="howList">
          <div class="how-item">Open any UPI app or scan the QR with your UPI app.</div>
          <div class="how-item">Confirm the UPI ID before approving.</div>
          <div class="how-item">Enter the exact amount in your UPI app (do not rely on defaults).</div>
          <div class="how-item">After payment, take a screenshot and send it to admin for confirmation.</div>
        </div>
      </div>

      <!-- contact -->
      <div class="contact-row">
        <button id="contactBtn" class="contact-btn">üí¨ Contact Admin</button>
        <div class="contact-small" id="contactSmall">Send Screenshot to Admin</div>
      </div>

    </div>
  </div>

<script>
/*
  BEHAVIOR:
  - qrlink and upiid are read from external config.js ONLY.
  - Carousel images, contact link/text are hardcoded here per your request.
  - Config polling continues to sync qrlink/upiid.
*/

/* --- hardcoded carousel images + contact info (per your instruction) --- */
const HARDCODED_CAROUSEL = [
  'https://i.ibb.co/gFPbGzZH/20251118-155331.jpg',
  'https://i.ibb.co/TBTd5S3p/20251118-160648.jpg',
  'https://i.ibb.co/fVJnf9V7/20251118-153613.jpg',
  // add more static images here if you want them displayed
];

const HARDCODED_CONTACT_LINK = 'https://wa.me/919999999999';
const HARDCODED_CONTACT_TEXT = 'Contact Admin';

/* --- UI elements --- */
const upiField = document.getElementById('upiField');
const qrImg = document.getElementById('qrimg');
const downloadBtn = document.getElementById('downloadBtn');
const slidesEl = document.getElementById('slides');
const carouselRoot = document.getElementById('carouselRoot');
const contactBtn = document.getElementById('contactBtn');
const copyBtn = document.getElementById('copyUpi');
let currentConfig = null;
let configScriptEl = null;
let carouselInterval = null;

/* --- toast --- */
function showToast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed'; t.style.left='50%'; t.style.bottom='22px'; t.style.transform='translateX(-50%)';
  t.style.background='rgba(11,97,255,0.95)'; t.style.color='#fff'; t.style.padding='8px 12px';
  t.style.borderRadius='8px'; t.style.boxShadow='0 8px 20px rgba(11,97,255,0.12)'; t.style.zIndex=9999;
  document.body.appendChild(t);
  setTimeout(()=>t.style.opacity='0.01',1500); setTimeout(()=>t.remove(),2000);
}

/* --- carousel population (use HARDCODED_CAROUSEL) --- */
function clearSlides(){ while(slidesEl.firstChild) slidesEl.removeChild(slidesEl.firstChild); const placeholder = carouselRoot.querySelector('.carousel-empty'); if(placeholder) placeholder.remove(); }

function populateSlides(urls){
  clearSlides();
  urls.forEach(url => {
    const s = document.createElement('div'); s.className = 'slide';
    const img = document.createElement('img'); img.src = url; img.alt = 'step';
    img.addEventListener('error', ()=> {
      img.style.display = 'none';
      const err = document.createElement('div');
      err.style.width = '100%'; err.style.height = '100%'; err.style.display = 'flex';
      err.style.alignItems = 'center'; err.style.justifyContent = 'center';
      err.style.color = '#94a3b8'; err.style.fontWeight = 700;
      err.textContent = 'Image unavailable';
      s.appendChild(err);
    });
    s.appendChild(img);
    slidesEl.appendChild(s);
  });
  if(urls.length === 0) showEmptyCarouselPlaceholder();
}

function showEmptyCarouselPlaceholder(){
  clearSlides();
  const ph = document.createElement('div');
  ph.className = 'carousel-empty';
  ph.textContent = 'No tutorial images configured';
  carouselRoot.appendChild(ph);
}

let cIndex = 0;
function showSlide(i){ slidesEl.style.transform = `translateX(-${i*100}%)`; }
function startCarousel(len){
  stopCarousel();
  if(!len || len <= 1) return;
  cIndex = 0;
  showSlide(0);
  carouselInterval = setInterval(()=>{ cIndex = (cIndex + 1) % len; showSlide(cIndex); }, 2200);
}
function stopCarousel(){
  if(carouselInterval){ clearInterval(carouselInterval); carouselInterval = null; }
  if(slidesEl) slidesEl.style.transform = 'translateX(0%)';
}

/* initialize hardcoded carousel */
populateSlides(HARDCODED_CAROUSEL);
startCarousel(HARDCODED_CAROUSEL.length);

/* --- apply config (qrlink & upiid only) --- */
function applyConfig(cfg){
  currentConfig = cfg || null;

  // UPI
  if(currentConfig && typeof currentConfig.upiid === 'string' && currentConfig.upiid.trim()){
    upiField.textContent = currentConfig.upiid.trim();
    copyBtn.classList.remove('disabled'); copyBtn.disabled = false;
  } else {
    upiField.textContent = '';
    copyBtn.classList.add('disabled'); copyBtn.disabled = true;
  }

  // QR image
  if(currentConfig && typeof currentConfig.qrlink === 'string' && currentConfig.qrlink.trim()){
    qrImg.src = currentConfig.qrlink.trim();
    qrImg.alt = 'QR image';
    downloadBtn.classList.remove('disabled'); downloadBtn.disabled = false;
  } else {
    qrImg.src = '';
    qrImg.alt = 'No QR configured';
    downloadBtn.classList.add('disabled'); downloadBtn.disabled = true;
  }

  // enable/disable app buttons based on UPI presence
  const appButtons = [
    document.getElementById('btnPaytm'),
    document.getElementById('btnGpay'),
    document.getElementById('btnPhonePe'),
    document.getElementById('btnOther')
  ];
  if(currentConfig && currentConfig.upiid){
    appButtons.forEach(b => { b.classList.remove('disabled'); b.disabled = false; });
  } else {
    appButtons.forEach(b => { b.classList.add('disabled'); b.disabled = true; });
  }

  // Contact button uses hardcoded values
  contactBtn.dataset.link = HARDCODED_CONTACT_LINK;
  contactBtn.textContent = HARDCODED_CONTACT_TEXT + '  üí¨';
  contactBtn.classList.remove('disabled');
  contactBtn.disabled = false;
}

/* --- load external config.js (cache-busted) --- */
function removeExistingConfigScript(){ if(configScriptEl && configScriptEl.parentNode) configScriptEl.remove(); configScriptEl = null; }
function loadConfigScript(){
  try { delete window.CONFIG; } catch(e) { window.CONFIG = undefined; }
  removeExistingConfigScript();
  const s = document.createElement('script');
  s.src = 'config.js?ts=' + Date.now();
  s.id = 'configScript';
  s.async = true;
  s.onload = () => {
    if(window.CONFIG && typeof window.CONFIG === 'object'){
      applyConfig(window.CONFIG);
      console.info('CONFIG loaded', window.CONFIG);
    } else {
      console.warn('config.js loaded but window.CONFIG not found or invalid.');
      applyConfig(null);
    }
  };
  s.onerror = () => {
    console.warn('Failed to load config.js');
    applyConfig(null);
  };
  document.head.appendChild(s);
  configScriptEl = s;
}

/* polling for config changes */
const CONFIG_POLL_INTERVAL_MS = 2500;
loadConfigScript();
setInterval(loadConfigScript, CONFIG_POLL_INTERVAL_MS);

/* --- Download QR --- */
async function downloadQr(){
  try{
    const src = qrImg.src;
    if(!src) throw new Error('No QR configured');
    const resp = await fetch(src, {mode:'cors'});
    if(!resp.ok) throw new Error('Network response not ok');
    const blob = await resp.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'upi-qr-' + Date.now() + '.png'; document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
    showToast('QR downloaded to device');
  }catch(err){
    console.warn('Download failed, fallback to open', err);
    if(qrImg.src){
      window.open(qrImg.src, '_blank');
      showToast('Could not download directly ‚Äî opened image to save manually');
    } else {
      showToast('No QR configured to download');
    }
  }
}
downloadBtn.addEventListener('click', downloadQr);

/* --- Copy UPI --- */
copyBtn.addEventListener('click', async ()=>{
  if(!currentConfig || !currentConfig.upiid){ showToast('No UPI configured'); return; }
  try{
    await navigator.clipboard.writeText(currentConfig.upiid);
    showToast('UPI copied to clipboard');
  }catch(e){
    const t = document.createElement('textarea'); t.value = currentConfig.upiid; document.body.appendChild(t); t.select();
    document.execCommand('copy'); t.remove();
    showToast('UPI copied to clipboard');
  }
});

/* --- App openers (use upiid from config) --- */
const PACK = { gpay:'com.google.android.apps.nbu.paisa.user', phonepe:'com.phonepe.app', paytm:'net.one97.paytm' };
function openChain(pref){
  if(!currentConfig || !currentConfig.upiid){ alert('UPI ID not configured.'); return; }
  const query = new URLSearchParams({pa: currentConfig.upiid, cu:'INR'}).toString();
  const generic = 'upi://pay?' + query;
  const ua = navigator.userAgent || '';
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  if(isAndroid){
    let i = 0;
    function next(){
      if(i >= pref.length){ window.location.href = generic; return; }
      const key = pref[i++]; const pkg = PACK[key];
      if(!pkg){ next(); return; }
      const intent = `intent://pay?${query}#Intent;scheme=upi;package=${pkg};end`;
      window.location.href = intent;
      setTimeout(next, 1200);
    }
    next();
  } else if(isIOS){
    window.location.href = generic;
  } else {
    alert('Open this page on a mobile device to complete the UPI payment.');
  }
}
document.getElementById('btnPaytm').addEventListener('click', ()=>openChain(['paytm','phonepe','gpay']));
document.getElementById('btnGpay').addEventListener('click', ()=>openChain(['gpay','phonepe','paytm']));
document.getElementById('btnPhonePe').addEventListener('click', ()=>openChain(['phonepe','paytm','gpay']));
document.getElementById('btnOther').addEventListener('click', ()=> {
  if(!currentConfig || !currentConfig.upiid){ alert('UPI ID not configured.'); return; }
  window.location.href = 'upi://pay?pa=' + encodeURIComponent(currentConfig.upiid) + '&cu=INR';
});

/* --- Contact --- */
contactBtn.addEventListener('click', ()=>{
  const link = contactBtn.dataset.link || HARDCODED_CONTACT_LINK;
  if(link) window.open(link, '_blank');
  else showToast('Contact link not configured');
});

/* --- qr image error fallback --- */
qrImg.addEventListener('error', ()=>{
  qrImg.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="20">QR Unavailable</text></svg>'
  );
});
</script>
</body>
</html>
