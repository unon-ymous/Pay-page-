<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pay Here ‚Äî UPI Payment</title>
  <style>
    :root{
      --page-bg:#eef6fb;
      --panel:#ffffff;
      --muted:#6b7280;
      --accent:#0b61ff;
      --radius:12px;
      --shadow:0 10px 30px rgba(12,20,40,0.06);
      --light-gray:#f3f4f6;
      --copy-gray:#eef2f6;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--page-bg);color:#0f1724}

    /* container */
    .page{max-width:760px;margin:18px auto;padding:0 12px}
    .card{background:linear-gradient(180deg,#f8fcff,#ffffff);border-radius:16px;padding:14px;box-shadow:var(--shadow);overflow:hidden}

    /* topbar */
    .topbar{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg,#e6f5ff,#dff2ff)}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#0b61ff,#33a1ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
    .title{font-size:26px;font-style:italic;color:#08324a;font-weight:800;letter-spacing:0.3px}

    /* QR area */
    .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px}
    .qr-frame{width:320px;height:320px;border-radius:12px;border:1px dashed rgba(8,12,20,0.06);overflow:hidden;background:#fff;display:grid;place-items:center}
    .qr-frame img{width:100%;height:100%;object-fit:cover;display:block}
    .controls{display:flex;gap:10px;align-items:center;width:92%}
    .download{flex:1;padding:12px;border-radius:18px;background:linear-gradient(90deg,#dff7e1,#c6f0c9);border:1px solid rgba(10,91,46,0.08);font-weight:700;cursor:pointer}

    /* UPI single thin box with copy inside */
    .upi-box{margin-top:10px;display:flex;align-items:center;gap:8px;width:92%}
    .upi-pill{flex:1;display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;background:#fafcff;border:1px solid rgba(8,12,20,0.06);font-weight:700}
    .upi-text{font-size:15px;color:#0b1f2f}
    .copy-btn{padding:6px 10px;border-radius:8px;background:var(--copy-gray);color:#425066;border:0;cursor:pointer;font-weight:700}

    /* apps */
    .apps{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .app-btn{padding:12px;border-radius:10px;border:0;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .paytm{background:linear-gradient(90deg,#e6f0ff,#cfe6ff);color:#003366}
    .gpay{background:linear-gradient(90deg,#fff,#fff7ed);color:#111;border:1px solid rgba(0,0,0,0.06)}
    .phonepe{background:linear-gradient(90deg,#f3e9ff,#efe2ff);color:#3a0b66}
    .other{background:linear-gradient(90deg,#dcd6ff,#cfc6ff);color:#221f3a} /* darker */

    /* carousel + static header */
    .carousel-wrap{margin-top:12px}

.carousel-header{
  padding:8px;
  border-radius:8px;
  background:linear-gradient(180deg,#f5f7fa,#ffffff);
  border:1px solid rgba(8,12,20,0.04);
  color:#475569;
  font-weight:700;
  font-size:14px;
}

.carousel{
  margin-top:8px;
  overflow:hidden;
  border-radius:8px;
  height:340px;
}

.slides{
  display:flex;
  transition:transform 0.6s ease;
  gap:0; /* remove spacing so no overlapping happens */
}

.slide{
  min-width:100%;
  flex-shrink:0;
  padding:0; /* remove padding causing the image peek */
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

.slide img{
  width:100%;
  height:340px;
  object-fit:contain; /* show FULL image inside frame */
  border-radius:8px;
}
    
    /* instructions in light shiny box (smaller text) */
    .instructions-box{margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#f8fbff,#ffffff);border:1px solid rgba(8,12,20,0.04);box-shadow:0 6px 18px rgba(11,97,255,0.03)}
    .how-title{font-weight:800;color:#111;margin-bottom:8px}
    .how-list{display:flex;flex-direction:column;gap:6px}
    .how-item{background:transparent;padding:6px;color:#475569;font-size:13px}

    /* contact */
    .contact-row{display:flex;flex-direction:column;align-items:center;gap:8px;margin-top:14px}
    .contact-btn{padding:12px 18px;border-radius:8px;background:#f3f4f6;color:#111;border:0;font-weight:800;cursor:pointer}
    .contact-small{font-size:13px;color:var(--muted);text-align:center}

    @media (max-width:480px){
      .qr-frame{width:260px;height:260px}
      .title{font-size:22px}
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <!-- top bar in the same card -->
      <div class="topbar">
        <div class="logo">Pay</div>
        <div class="title">Pay Here</div>
      </div>

      <!-- QR area -->
      <div class="qr-wrap">
        <div class="qr-frame" id="qrframe"><img id="qrimg" src="" alt="QR image"></div>
        <div class="controls">
          <button id="downloadBtn" class="download">Download QR Code</button>
        </div>
      </div>

      <!-- UPI thin pill with copy -->
      <div class="upi-box">
        <div class="upi-pill">
          <div class="upi-text" id="upiField">merchant@upi</div>
          <button id="copyUpi" class="copy-btn">Copy</button>
        </div>
      </div>

      <!-- App buttons -->
      <div class="apps">
        <button id="btnPaytm" class="app-btn paytm">PAYTM</button>
        <button id="btnGpay" class="app-btn gpay">G PAY</button>
        <button id="btnPhonePe" class="app-btn phonepe">Phone ‡§™‡•á</button>
        <button id="btnOther" class="app-btn other">Other UPI Apps</button>
      </div>

      <!-- carousel header (static) and carousel (images move) -->
      <div class="carousel-wrap">
        <div class="carousel-header">üì≤  How to send payment Screenshot</div>
        <div class="carousel"><div class="slides" id="slides"></div></div>
      </div>

      <!-- instructions -->
      <div class="instructions-box">
        <div class="how-title">Instruction ‚ùó</div>
        <div class="how-list" id="howList"></div>
      </div>

      <!-- contact -->
      <div class="contact-row">
        <button id="contactBtn" class="contact-btn">üí¨ Contact Admin</button>
        <div class="contact-small" id="contactSmall">Sesnd Screenshot to Admin</div>
      </div>

    </div>
  </div>

  <!-- load config first -->
  <script src="config.js"></script>

  <script>
  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', function () {

    // Default ADMIN config (kept same as before)
    const ADMIN = {
      upi: 'merchant@upi',
      payeeName: 'Merchant Name',
      contactLink: 'https://wa.me/919999999999',
      contactText: 'Contact Admin',
      carousel: [
        'https://i.ibb.co/gFPbGzZH/20251118-155331.jpg',
        'https://i.ibb.co/TBTd5S3p/20251118-160648.jpg',
        'https://i.ibb.co/fVJnf9V7/20251118-153613.jpg'
      ],
      instructions: [
        'Open any UPI app or scan the QR with your UPI app.',
        'Confirm the UPI ID and payee name before approving.',
        'Enter the exact amount in your UPI app (do not rely on defaults).',
        'After payment, take a screenshot and send it to admin for confirmation.'
      ]
    };

    // Safely apply external config if present
    try {
      if (window.PAY_CONFIG && typeof window.PAY_CONFIG === 'object') {
        const cfg = window.PAY_CONFIG;
        if (typeof cfg.Upiid === 'string' && cfg.Upiid.trim() !== '') {
          ADMIN.upi = cfg.Upiid.trim();
        }
        if (typeof cfg.Qrlink === 'string' && cfg.Qrlink.trim() !== '') {
          ADMIN._QRLINK = cfg.Qrlink.trim();
        }
      }
    } catch (e) {
      console.warn('Error reading config.js', e);
    }

    // Element refs
    const upiField = document.getElementById('upiField');
    const qrImg = document.getElementById('qrimg');
    const downloadBtn = document.getElementById('downloadBtn');
    const slidesEl = document.getElementById('slides');
    const howList = document.getElementById('howList');
    const contactBtn = document.getElementById('contactBtn');

    // Show UPI
    if (upiField) upiField.textContent = ADMIN.upi;
    if (contactBtn) contactBtn.textContent = (ADMIN.contactText || 'Contact Admin') + '  üí¨';

    // Build UPI URI for QR generation fallback
    function buildUpiUri() {
      const params = new URLSearchParams({ pa: ADMIN.upi, pn: ADMIN.payeeName, cu: 'INR' });
      return 'upi://pay?' + params.toString();
    }
    function initialQrSrc() {
      const uri = buildUpiUri();
      return `https://chart.googleapis.com/chart?cht=qr&chs=1000x1000&chl=${encodeURIComponent(uri)}`;
    }

    // Set QR src: config Qrlink wins, otherwise generated from UPI
    if (ADMIN._QRLINK) {
      qrImg.src = ADMIN._QRLINK;
    } else {
      qrImg.src = initialQrSrc();
    }

    // Populate carousel safely
    slidesEl.innerHTML = ''; // clear
    if (Array.isArray(ADMIN.carousel) && ADMIN.carousel.length > 0) {
      ADMIN.carousel.forEach(url => {
        const s = document.createElement('div'); s.className = 'slide';
        const img = document.createElement('img'); img.src = url; img.alt = 'step';
        s.appendChild(img); slidesEl.appendChild(s);
      });
    } else {
      // placeholder if no images provided
      const s = document.createElement('div'); s.className = 'slide';
      const img = document.createElement('img');
      img.alt = 'no steps';
      img.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="340"><rect width="100%" height="100%" fill="#fff"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="18">No tutorial images</text></svg>';
      s.appendChild(img); slidesEl.appendChild(s);
    }

    // Carousel behavior
    let cIndex = 0;
    function showSlide(i) { slidesEl.style.transform = `translateX(-${i * 100}%)`; }
    // Start interval only if more than 1 slide
    if (slidesEl.children.length > 1) {
      setInterval(() => { cIndex = (cIndex + 1) % slidesEl.children.length; showSlide(cIndex); }, 2200);
    }

    // Populate instructions
    howList.innerHTML = '';
    if (Array.isArray(ADMIN.instructions)) {
      ADMIN.instructions.forEach(line => {
        const d = document.createElement('div'); d.className = 'how-item'; d.textContent = line; howList.appendChild(d);
      });
    }

    // Download QR: fetch -> blob -> download
    async function downloadQr() {
      try {
        const src = qrImg.src;
        const resp = await fetch(src, { mode: 'cors' });
        if (!resp.ok) throw new Error('Network response not ok');
        const blob = await resp.blob();
        triggerDownload(blob, 'upi-qr-' + Date.now() + '.png');
        showToast('QR downloaded to device');
      } catch (err) {
        console.warn('Download failed, fallback to open', err);
        window.open(qrImg.src, '_blank');
        showToast('Could not download directly ‚Äî opened image to save manually');
      }
    }
    function triggerDownload(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }
    if (downloadBtn) downloadBtn.addEventListener('click', downloadQr);

    // Copy UPI
    const copyBtn = document.getElementById('copyUpi');
    if (copyBtn) {
      copyBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(ADMIN.upi);
          showToast('UPI copied to clipboard');
        } catch (e) {
          const t = document.createElement('textarea'); t.value = ADMIN.upi; document.body.appendChild(t); t.select();
          document.execCommand('copy'); t.remove();
          showToast('UPI copied to clipboard');
        }
      });
    }

    // App openers
    const PACK = { gpay: 'com.google.android.apps.nbu.paisa.user', phonepe: 'com.phonepe.app', paytm: 'net.one97.paytm' };
    function openChain(pref) {
      const query = new URLSearchParams({ pa: ADMIN.upi, pn: ADMIN.payeeName, cu: 'INR' }).toString();
      const generic = 'upi://pay?' + query;
      const ua = navigator.userAgent || '';
      const isAndroid = /Android/i.test(ua);
      const isIOS = /iPhone|iPad|iPod/i.test(ua);
      if (isAndroid) {
        let i = 0;
        function next() {
          if (i >= pref.length) { window.location.href = generic; return; }
          const key = pref[i++]; const pkg = PACK[key];
          if (!pkg) { next(); return; }
          const intent = `intent://pay?${query}#Intent;scheme=upi;package=${pkg};end`;
          window.location.href = intent;
          setTimeout(next, 1200);
        }
        next();
      } else if (isIOS) {
        window.location.href = generic;
      } else {
        alert('Open this page on a mobile device to complete the UPI payment.');
      }
    }

    const btnPaytm = document.getElementById('btnPaytm');
    const btnGpay = document.getElementById('btnGpay');
    const btnPhonePe = document.getElementById('btnPhonePe');
    const btnOther = document.getElementById('btnOther');

    if (btnPaytm) btnPaytm.addEventListener('click', () => openChain(['paytm', 'phonepe', 'gpay']));
    if (btnGpay) btnGpay.addEventListener('click', () => openChain(['gpay', 'phonepe', 'paytm']));
    if (btnPhonePe) btnPhonePe.addEventListener('click', () => openChain(['phonepe', 'paytm', 'gpay']));
    if (btnOther) btnOther.addEventListener('click', () => { window.location.href = 'upi://pay?pa=' + encodeURIComponent(ADMIN.upi) + '&pn=' + encodeURIComponent(ADMIN.payeeName) + '&cu=INR'; });

    // Contact
    if (contactBtn) contactBtn.addEventListener('click', () => window.open(ADMIN.contactLink, '_blank'));

    // small toast
    function showToast(msg) {
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position = 'fixed'; t.style.left = '50%'; t.style.bottom = '22px'; t.style.transform = 'translateX(-50%)';
      t.style.background = 'rgba(11,97,255,0.95)'; t.style.color = '#fff'; t.style.padding = '8px 12px';
      t.style.borderRadius = '8px'; t.style.boxShadow = '0 8px 20px rgba(11,97,255,0.12)'; t.style.zIndex = 9999;
      document.body.appendChild(t);
      setTimeout(() => t.style.opacity = '0.01', 1500); setTimeout(() => t.remove(), 2000);
    }

    // fallback if QR fails to load
    qrImg.addEventListener('error', () => {
      qrImg.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="20">QR Unavailable</text></svg>';
    });

  }); // DOMContentLoaded end
  </script>

</body>
</html>
