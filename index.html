<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Pay Here ‚Äî UPI Payment</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --page-bg:#eef6fb;
      --panel:#ffffff;
      --muted:#6b7280;
      --accent:#0b61ff;
      --radius:12px;
      --shadow:0 10px 30px rgba(12,20,40,0.06);
      --light-gray:#f3f4f6;
      --copy-gray:#eef2f6;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--page-bg);color:#0f1724}

    /* container */
    .page{max-width:760px;margin:18px auto;padding:0 12px}
    .card{background:linear-gradient(180deg,#f8fcff,#ffffff);border-radius:16px;padding:14px;box-shadow:var(--shadow);overflow:hidden}

    /* topbar */
    .topbar{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg,#e6f5ff,#dff2ff)}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#0b61ff,#33a1ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
    .title{font-size:26px;font-style:italic;color:#08324a;font-weight:800;letter-spacing:0.3px}

    /* QR area */
    .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px}
    .qr-frame{width:320px;height:320px;border-radius:12px;border:1px dashed rgba(8,12,20,0.06);overflow:hidden;background:#fff;display:grid;place-items:center}
    .qr-frame img{width:100%;height:100%;object-fit:cover;display:block}
    .controls{display:flex;gap:10px;align-items:center;width:92%}
    .download{flex:1;padding:12px;border-radius:18px;background:linear-gradient(90deg,#dff7e1,#c6f0c9);border:1px solid rgba(10,91,46,0.08);font-weight:700;cursor:pointer}

    /* UPI single thin box with copy inside */
    .upi-box{margin-top:10px;display:flex;align-items:center;gap:8px;width:92%}
    .upi-pill{flex:1;display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;background:#fafcff;border:1px solid rgba(8,12,20,0.06);font-weight:700}
    .upi-text{font-size:15px;color:#0b1f2f}
    .copy-btn{padding:6px 10px;border-radius:8px;background:var(--copy-gray);color:#425066;border:0;cursor:pointer;font-weight:700}

    /* apps - slightly darker than before */
    .apps{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .app-btn{padding:12px;border-radius:10px;border:0;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(2,6,23,0.04)}
    .paytm{background:linear-gradient(90deg,#dfe9ff,#cfe0ff);color:#002a55}
    .gpay{background:linear-gradient(90deg,#fff8ef,#fff4e6);color:#111;border:1px solid rgba(0,0,0,0.06)}
    .phonepe{background:linear-gradient(90deg,#efdeff,#e8dbff);color:#2b0752}
    .other{background:linear-gradient(90deg,#d0c6ff,#c6b9ff);color:#221f3a} /* darker */

    /* carousel + static header */
    .carousel-wrap{margin-top:12px}

.carousel-header{
  padding:8px;
  border-radius:8px;
  background:linear-gradient(180deg,#f5f7fa,#ffffff);
  border:1px solid rgba(8,12,20,0.04);
  color:#475569;
  font-weight:700;
  font-size:14px;
}

.carousel{
  margin-top:8px;
  overflow:hidden;
  border-radius:8px;
  height:340px;
}

.slides{
  display:flex;
  transition:transform 0.6s ease;
  gap:0; /* remove spacing so no overlapping happens */
}

.slide{
  min-width:100%;
  flex-shrink:0;
  padding:0; /* remove padding causing the image peek */
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

.slide img{
  width:100%;
  height:340px;
  object-fit:contain; /* show FULL image inside frame */
  border-radius:8px;
}
    
    /* instructions in light shiny box (smaller text) */
    .instructions-box{margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#f8fbff,#ffffff);border:1px solid rgba(8,12,20,0.04);box-shadow:0 6px 18px rgba(11,97,255,0.03)}
    .how-title{font-weight:800;color:#111;margin-bottom:8px}
    .how-list{display:flex;flex-direction:column;gap:6px}
    .how-item{background:transparent;padding:6px;color:#475569;font-size:13px}

    /* contact */
    .contact-row{display:flex;flex-direction:column;align-items:center;gap:8px;margin-top:14px}
    .contact-btn{padding:12px 18px;border-radius:8px;background:#f3f4f6;color:#111;border:0;font-weight:800;cursor:pointer}
    .contact-small{font-size:13px;color:var(--muted);text-align:center}

    @media (max-width:480px){
      .qr-frame{width:260px;height:260px}
      .title{font-size:22px}
    }

    /* ---- Admin modal styles (hidden by default) ---- */
    .admin-modal-backdrop{
      position:fixed;inset:0;background:rgba(5,8,20,0.45);display:none;align-items:center;justify-content:center;z-index:9998;
    }
    .admin-modal{
      width:92%;max-width:720px;border-radius:12px;background:#fff;padding:16px;box-shadow:0 30px 80px rgba(2,6,23,0.35);
      transform:translateY(0);max-height:88vh;overflow:auto;
    }
    .admin-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
    .admin-title{font-weight:900;font-size:18px}
    .admin-row{display:flex;flex-direction:column;gap:8px;margin-bottom:10px}
    .admin-input{padding:10px;border-radius:8px;border:1px solid rgba(8,12,20,0.06);font-size:14px}
    .admin-actions{display:flex;gap:8px;justify-content:flex-end}
    .btn{padding:10px 12px;border-radius:10px;border:0;font-weight:800;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,#0b61ff,#2189ff);color:#fff}
    .btn-ghost{background:#f3f4f6;color:#111}

    /* preview */
    .preview{width:160px;height:160px;border-radius:8px;background:#f7fafc;border:1px dashed rgba(8,12,20,0.04);display:grid;place-items:center;overflow:hidden}
    .preview img{width:100%;height:100%;object-fit:contain;display:block}

    /* hidden tap area - invisible but clickable */
    #secretTap{
      position:fixed;left:12px;bottom:12px;width:48px;height:48px;opacity:0;z-index:9999;border-radius:8px; /* invisible */
      /* no pointer-events:none ‚Äî it must accept taps */
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="card">
      <!-- top bar in the same card -->
      <div class="topbar">
        <div class="logo">Pay</div>
        <div class="title">Pay Here</div>
      </div>

      <!-- QR area -->
      <div class="qr-wrap">
        <div class="qr-frame" id="qrframe"><img id="qrimg" src="" alt="QR image"></div>
        <div class="controls">
          <button id="downloadBtn" class="download">Download QR Code</button>
        </div>
      </div>

      <!-- UPI thin pill with copy -->
      <div class="upi-box">
        <div class="upi-pill">
          <div class="upi-text" id="upiField">merchant@upi</div>
          <button id="copyUpi" class="copy-btn">Copy</button>
        </div>
      </div>

      <!-- App buttons -->
      <div class="apps">
        <button id="btnPaytm" class="app-btn paytm">PAYTM</button>
        <button id="btnGpay" class="app-btn gpay">G PAY</button>
        <button id="btnPhonePe" class="app-btn phonepe">Phone ‡§™‡•á</button>
        <button id="btnOther" class="app-btn other">Other UPI Apps</button>
      </div>

      <!-- carousel header (static) and carousel (images move) -->
      <div class="carousel-wrap">
        <div class="carousel-header">üì≤  How to send payment Screenshot</div>
        <div class="carousel"><div class="slides" id="slides"></div></div>
      </div>

      <!-- instructions -->
      <div class="instructions-box">
        <div class="how-title">Instruction ‚ùó</div>
        <div class="how-list" id="howList"></div>
      </div>

      <!-- contact -->
      <div class="contact-row">
        <button id="contactBtn" class="contact-btn">üí¨ Contact Admin</button>
        <div class="contact-small" id="contactSmall">Sesnd Screenshot to Admin</div>
      </div>

    </div>
  </div>

  <!-- invisible secret tap area (bottom-left) -->
  <div id="secretTap" title="secret"></div>

  <!-- Admin modal (hidden by default) -->
  <div id="adminBackdrop" class="admin-modal-backdrop" aria-hidden="true">
    <div class="admin-modal" role="dialog" aria-modal="true" aria-labelledby="adminTitle">
      <div class="admin-header">
        <div class="admin-title" id="adminTitle">Admin Panel</div>
        <div style="font-size:13px;color:#667085">Protected area</div>
      </div>

      <div class="admin-row">
        <label style="font-weight:800">ImgBB API Key (required for image uploads)</label>
        <input id="imgbbKey" class="admin-input" placeholder="Paste your ImgBB API key here (keeps in localStorage)">
        <div style="font-size:12px;color:#6b7280">You can get a key from <strong>https://api.imgbb.com/</strong>. The key is stored only in your browser's localStorage (not sent elsewhere except to ImgBB when uploading).</div>
      </div>

      <div class="admin-row" style="flex-direction:row;gap:12px;align-items:flex-start">
        <div style="flex:1;display:flex;flex-direction:column;gap:6px">
          <label style="font-weight:800">Change UPI ID</label>
          <input id="adminUpi" class="admin-input" placeholder="merchant@upi">
        </div>
        <div style="width:180px;display:flex;flex-direction:column;gap:6px;align-items:center">
          <div style="font-weight:800">QR Preview</div>
          <div class="preview" id="qrPreview"><img id="qrPreviewImg" src="" alt="preview"></div>
        </div>
      </div>

      <div class="admin-row">
        <label style="font-weight:800">Upload QR image from device (optional)</label>
        <input id="qrFile" type="file" accept="image/*" class="admin-input">
        <div style="font-size:13px;color:#6b7280">If you upload a file, it'll be sent to ImgBB (requires the API key above). After upload the returned public URL will be used as the QR image for all users.</div>
      </div>

      <div class="admin-actions">
        <button id="adminCancel" class="btn btn-ghost">Cancel</button>
        <button id="adminSave" class="btn btn-primary">Save & Apply</button>
      </div>
    </div>
  </div>

<script>
/* ================= ADMIN CONFIG =================
 * Change the values below to your real UPI, payee name and contact link.
 * ================================================= */
const ADMIN = {
  upi: localStorage.getItem('ADMIN_UPI') || 'merchant@upi',                // <-- stored value (falls back to default)
  payeeName: 'Merchant Name',         // <-- payee name
  contactLink: 'https://wa.me/919999999999', // <-- your WhatsApp/Telegram link
  contactText: 'Contact Admin',
  carousel: [
    // leave these the same as your original links
    'https://i.ibb.co/gFPbGzZH/20251118-155331.jpg',
    'https://i.ibb.co/TBTd5S3p/20251118-160648.jpg',
    'https://i.ibb.co/fVJnf9V7/20251118-153613.jpg'
  ],
  instructions: [
    'Open any UPI app or scan the QR with your UPI app.',
    'Confirm the UPI ID and payee name before approving.',
    'Enter the exact amount in your UPI app (do not rely on defaults).',
    'After payment, take a screenshot and send it to admin for confirmation.'
  ]
};
/* ================================================= */

const upiField = document.getElementById('upiField');
const qrImg = document.getElementById('qrimg');
const downloadBtn = document.getElementById('downloadBtn');
const slidesEl = document.getElementById('slides');
const howList = document.getElementById('howList');
const contactBtn = document.getElementById('contactBtn');

upiField.textContent = ADMIN.upi;
contactBtn.textContent = (ADMIN.contactText || 'Contact Admin') + '  üí¨';

/* Generate initial QR from UPI URI (no amount included so user enters in app) */
function buildUpiUri(upi){
  const params = new URLSearchParams({pa:upi,pn:ADMIN.payeeName,cu:'INR'});
  return 'upi://pay?' + params.toString();
}
function initialQrSrcFromUri(upi){
  const uri = buildUpiUri(upi);
  // Use Google Chart API to generate QR (1000x1000 for quality)
  return `https://chart.googleapis.com/chart?cht=qr&chs=1000x1000&chl=${encodeURIComponent(uri)}`;
}

/* If a custom uploaded QR URL exists in localStorage, prefer it (so updates persist across reloads) */
const storedQrUrl = localStorage.getItem('ADMIN_QR_URL');
if(storedQrUrl){
  qrImg.src = storedQrUrl;
} else {
  qrImg.src = initialQrSrcFromUri(ADMIN.upi);
}

/* Populate carousel images (unchanged) */
ADMIN.carousel.forEach(url => {
  const s = document.createElement('div'); s.className = 'slide';
  const img = document.createElement('img'); img.src = url; img.alt = 'step';
  s.appendChild(img); slidesEl.appendChild(s);
});
let cIndex = 0;
function showSlide(i){ slidesEl.style.transform = `translateX(-${i*100}%)`; }
setInterval(()=>{ cIndex = (cIndex+1) % ADMIN.carousel.length; showSlide(cIndex); }, 2200);

/* Populate instructions (smaller text) */
ADMIN.instructions.forEach(line => {
  const d = document.createElement('div'); d.className = 'how-item'; d.textContent = line; howList.appendChild(d);
});

/* Download QR: fetch -> blob -> download (best-effort) */
async function downloadQr(){
  try{
    const src = qrImg.src;
    const resp = await fetch(src, {mode:'cors'});
    if(!resp.ok) throw new Error('Network response not ok');
    const blob = await resp.blob();
    triggerDownload(blob, 'upi-qr-' + Date.now() + '.png');
    showToast('QR downloaded to device');
  }catch(err){
    console.warn('Download failed, fallback to open', err);
    // fallback: open image (user can long-press to save)
    window.open(qrImg.src, '_blank');
    showToast('Could not download directly ‚Äî opened image to save manually');
  }
}
function triggerDownload(blob, filename){
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}
downloadBtn.addEventListener('click', downloadQr);

/* Copy UPI to clipboard */
document.getElementById('copyUpi').addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(ADMIN.upi);
    showToast('UPI copied to clipboard');
  }catch(e){
    const t = document.createElement('textarea'); t.value = ADMIN.upi; document.body.appendChild(t); t.select();
    document.execCommand('copy'); t.remove();
    showToast('UPI copied to clipboard');
  }
});

/* App openers (no amount passed) */
const PACK = { gpay:'com.google.android.apps.nbu.paisa.user', phonepe:'com.phonepe.app', paytm:'net.one97.paytm' };
function openChain(pref){
  const query = new URLSearchParams({pa:ADMIN.upi,pn:ADMIN.payeeName,cu:'INR'}).toString();
  const generic = 'upi://pay?' + query;
  const ua = navigator.userAgent || '';
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  if(isAndroid){
    let i = 0;
    function next(){
      if(i >= pref.length){ window.location.href = generic; return; }
      const key = pref[i++]; const pkg = PACK[key];
      if(!pkg){ next(); return; }
      const intent = `intent://pay?${query}#Intent;scheme=upi;package=${pkg};end`;
      window.location.href = intent;
      setTimeout(next, 1200);
    }
    next();
  } else if(isIOS){
    window.location.href = generic;
  } else {
    alert('Open this page on a mobile device to complete the UPI payment.');
  }
}
document.getElementById('btnPaytm').addEventListener('click', ()=>openChain(['paytm','phonepe','gpay']));
document.getElementById('btnGpay').addEventListener('click', ()=>openChain(['gpay','phonepe','paytm']));
document.getElementById('btnPhonePe').addEventListener('click', ()=>openChain(['phonepe','paytm','gpay']));
document.getElementById('btnOther').addEventListener('click', ()=>{ window.location.href = 'upi://pay?pa='+encodeURIComponent(ADMIN.upi)+'&pn='+encodeURIComponent(ADMIN.payeeName)+'&cu=INR'; });

/* Contact */
contactBtn.addEventListener('click', ()=> window.open(ADMIN.contactLink, '_blank'));

/* small toast */
function showToast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed'; t.style.left='50%'; t.style.bottom='22px'; t.style.transform='translateX(-50%)';
  t.style.background='rgba(11,97,255,0.95)'; t.style.color='#fff'; t.style.padding='8px 12px';
  t.style.borderRadius='8px'; t.style.boxShadow='0 8px 20px rgba(11,97,255,0.12)'; t.style.zIndex=9999;
  document.body.appendChild(t);
  setTimeout(()=>t.style.opacity='0.01',1500); setTimeout(()=>t.remove(),2000);
}

/* fallback if QR fails to load */
qrImg.addEventListener('error', ()=>{ qrImg.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="20">QR Unavailable</text></svg>'; });

/* ----------------- Hidden/Secret tap logic ----------------- */
const secretTap = document.getElementById('secretTap');
let tapCount = 0;
let lastTapTime = 0;
const SECRET_REQUIRED = 10;
const SECRET_PASS = 'fassvord'; // per your request

secretTap.addEventListener('click', () => {
  const now = Date.now();
  // reset if too slow (10s)
  if(now - lastTapTime > 10000) tapCount = 0;
  lastTapTime = now;
  tapCount++;
  // subtle visual debug (disabled by default - we don't change UI): console.log('secret tap', tapCount);
  if(tapCount >= SECRET_REQUIRED){
    tapCount = 0;
    promptForPass();
  }
});

function promptForPass(){
  const p = prompt('Enter admin password:');
  if(p === SECRET_PASS){
    openAdminModal();
  } else {
    if(p !== null) alert('Wrong password.');
  }
}

/* ----------------- Admin modal behavior ----------------- */
const adminBackdrop = document.getElementById('adminBackdrop');
const imgbbKeyInput = document.getElementById('imgbbKey');
const adminUpiInput = document.getElementById('adminUpi');
const qrFileInput = document.getElementById('qrFile');
const qrPreviewImg = document.getElementById('qrPreviewImg');
const adminSaveBtn = document.getElementById('adminSave');
const adminCancelBtn = document.getElementById('adminCancel');

// load stored values
imgbbKeyInput.value = localStorage.getItem('IMGBB_API_KEY') || '';
adminUpiInput.value = localStorage.getItem('ADMIN_UPI') || ADMIN.upi;
qrPreviewImg.src = localStorage.getItem('ADMIN_QR_URL') || qrImg.src;

// open/close
function openAdminModal(){
  adminBackdrop.style.display = 'flex';
  adminBackdrop.setAttribute('aria-hidden','false');
  // populate inputs with current live values
  imgbbKeyInput.value = localStorage.getItem('IMGBB_API_KEY') || '';
  adminUpiInput.value = localStorage.getItem('ADMIN_UPI') || ADMIN.upi;
  qrPreviewImg.src = localStorage.getItem('ADMIN_QR_URL') || qrImg.src;
}
function closeAdminModal(){
  adminBackdrop.style.display = 'none';
  adminBackdrop.setAttribute('aria-hidden','true');
}

// preview selected file
qrFileInput.addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    qrPreviewImg.src = ev.target.result;
  };
  reader.readAsDataURL(f);
});

// Cancel
adminCancelBtn.addEventListener('click', ()=>{
  closeAdminModal();
});

// Save & Apply logic
adminSaveBtn.addEventListener('click', async ()=>{
  const newKey = imgbbKeyInput.value.trim();
  const newUpi = adminUpiInput.value.trim() || ADMIN.upi;
  const f = qrFileInput.files && qrFileInput.files[0];

  // store the API key and UPI locally (so admin doesn't have to re-enter every time)
  if(newKey) localStorage.setItem('IMGBB_API_KEY', newKey);
  if(newUpi) localStorage.setItem('ADMIN_UPI', newUpi);

  showToast('Applying changes...');

  // update UPI immediately (will also be used if no file uploaded)
  ADMIN.upi = newUpi;
  upiField.textContent = newUpi;
  localStorage.setItem('ADMIN_UPI', newUpi);

  // If file provided -> upload to ImgBB, get returned 
  if(f){
    const apiKey = newKey || localStorage.getItem('IMGBB_API_KEY');
    if(!apiKey){
      alert('ImgBB API key is required to upload images. Paste your API key in the ImgBB API Key field and try again.');
      return;
    }
    try{
      // read file as base64
      const base64 = await readFileAsDataURL(f);
      // strip the data: prefix
      const b64clean = base64.replace(/^data:.+;base64,/, '');
      // Prepare form data
      const fd = new FormData();
      fd.append('image', b64clean);
      // optional name param:
      fd.append('name', 'upi-qr-' + Date.now());
      // POST to ImgBB upload endpoint
      const resp = await fetch('https://api.imgbb.com/1/upload?key=' + encodeURIComponent(apiKey), {
        method: 'POST',
        body: fd
      });
      const j = await resp.json();
      if(j && j.success && j.data && j.data.display_url){
        const uploadedUrl = j.data.display_url;
        // save url persistently
        localStorage.setItem('ADMIN_QR_URL', uploadedUrl);
        // update QR shown on main page
        qrImg.src = uploadedUrl;
        qrPreviewImg.src = uploadedUrl;
        showToast('QR uploaded & updated for all users');
      } else {
        console.error('ImgBB upload failed', j);
        alert('ImgBB upload failed. Check API key and network. Response: ' + (j && j.error && j.error.message ? j.error.message : JSON.stringify(j)));
      }
    }catch(err){
      console.error('Upload error', err);
      alert('Upload failed: ' + err.message);
    } finally {
      closeAdminModal();
    }
  } else {
    // no file uploaded; regenerate QR from new UPI using Google Chart API
    localStorage.removeItem('ADMIN_QR_URL'); // remove custom QR URL if any
    const newGenerated = initialQrSrcFromUri(ADMIN.upi);
    qrImg.src = newGenerated;
    qrPreviewImg.src = newGenerated;
    showToast('UPI updated ‚Äî QR regenerated');
    closeAdminModal();
  }
});

/* helper to read file as data URL */
function readFileAsDataURL(file){
  return new Promise((resolve,reject)=>{
    const r = new FileReader();
    r.onload = ()=>resolve(r.result);
    r.onerror = e=>reject(e);
    r.readAsDataURL(file);
  });
}

/* Close modal when clicking outside modal content */
adminBackdrop.addEventListener('click', (e)=>{
  if(e.target === adminBackdrop) closeAdminModal();
});

/* ----------------- End of admin code ----------------- */

</script>
</body>
</html>
