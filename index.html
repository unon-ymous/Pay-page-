<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pay Here ‚Äî UPI Payment</title>
  <style>
    :root{
      --page-bg:#eef6fb;
      --panel:#ffffff;
      --muted:#6b7280;
      --accent:#0b61ff;
      --radius:12px;
      --shadow:0 10px 30px rgba(12,20,40,0.06);
      --light-gray:#f3f4f6;
      --copy-gray:#eef2f6;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--page-bg);color:#0f1724}

    /* container */
    .page{max-width:760px;margin:18px auto;padding:0 12px}
    .card{background:linear-gradient(180deg,#f8fcff,#ffffff);border-radius:16px;padding:14px;box-shadow:var(--shadow);overflow:hidden}

    /* topbar */
    .topbar{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg,#e6f5ff,#dff2ff)}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#0b61ff,#33a1ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
    .title{font-size:26px;font-style:italic;color:#08324a;font-weight:800;letter-spacing:0.3px}

    /* QR area */
    .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px}
    .qr-frame{width:320px;height:320px;border-radius:12px;border:1px dashed rgba(8,12,20,0.06);overflow:hidden;background:#fff;display:grid;place-items:center}
    .qr-frame img{width:100%;height:100%;object-fit:cover;display:block}
    .controls{display:flex;gap:10px;align-items:center;width:92%}
    .download{flex:1;padding:12px;border-radius:18px;background:linear-gradient(90deg,#dff7e1,#c6f0c9);border:1px solid rgba(10,91,46,0.08);font-weight:700;cursor:pointer}

    /* UPI single thin box with copy inside */
    .upi-box{margin-top:10px;display:flex;align-items:center;gap:8px;width:92%}
    .upi-pill{flex:1;display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;background:#fafcff;border:1px solid rgba(8,12,20,0.06);font-weight:700}
    .upi-text{font-size:15px;color:#0b1f2f}
    .copy-btn{padding:6px 10px;border-radius:8px;background:var(--copy-gray);color:#425066;border:0;cursor:pointer;font-weight:700}

    /* apps */
    .apps{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .app-btn{padding:12px;border-radius:10px;border:0;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 10px rgba(2,6,23,0.03)}
    .paytm{background:linear-gradient(90deg,#dbe8ff,#cfe6ff);color:#002244}
    .gpay{background:linear-gradient(90deg,#fff,#fff7ed);color:#0b0b0b;border:1px solid rgba(0,0,0,0.06)}
    .phonepe{background:linear-gradient(90deg,#e9ddff,#efe2ff);color:#3a0b66}
    .other{background:linear-gradient(90deg,#d6cfff,#cfc6ff);color:#221f3a} /* slightly darker */

    /* carousel + static header */
    .carousel-wrap{margin-top:12px}

.carousel-header{
  padding:8px;
  border-radius:8px;
  background:linear-gradient(180deg,#f5f7fa,#ffffff);
  border:1px solid rgba(8,12,20,0.04);
  color:#475569;
  font-weight:700;
  font-size:14px;
}

.carousel{
  margin-top:8px;
  overflow:hidden;
  border-radius:8px;
  height:340px;
}

.slides{
  display:flex;
  transition:transform 0.6s ease;
  gap:0; /* remove spacing so no overlapping happens */
}

.slide{
  min-width:100%;
  flex-shrink:0;
  padding:0; /* remove padding causing the image peek */
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

.slide img{
  width:100%;
  height:340px;
  object-fit:contain; /* show FULL image inside frame */
  border-radius:8px;
}
    
    /* instructions in light shiny box (smaller text) */
    .instructions-box{margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#f8fbff,#ffffff);border:1px solid rgba(8,12,20,0.04);box-shadow:0 6px 18px rgba(11,97,255,0.03)}
    .how-title{font-weight:800;color:#111;margin-bottom:8px}
    .how-list{display:flex;flex-direction:column;gap:6px}
    .how-item{background:transparent;padding:6px;color:#475569;font-size:13px}

    /* contact */
    .contact-row{display:flex;flex-direction:column;align-items:center;gap:8px;margin-top:14px}
    .contact-btn{padding:12px 18px;border-radius:8px;background:#f3f4f6;color:#111;border:0;font-weight:800;cursor:pointer}
    .contact-small{font-size:13px;color:var(--muted);text-align:center}

    /* hidden admin trigger (tiny and invisible) */
    .hidden-trigger{
      position:fixed;
      left:8px;
      bottom:8px;
      width:18px;
      height:18px;
      z-index:2147483645;
      opacity:0; /* invisible */
      touch-action: manipulation;
      /* Keep it clickable but invisible - DON'T change visual UI */
    }

    /* admin modal */
    .admin-overlay{
      position:fixed;inset:0;background:rgba(3,6,23,0.45);display:flex;align-items:center;justify-content:center;z-index:2147483646;
    }
    .admin-modal{
      width:92%;
      max-width:720px;
      background:#fff;border-radius:12px;padding:16px;box-shadow:0 18px 60px rgba(2,6,23,0.25);max-height:86vh;overflow:auto;
    }
    .admin-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .admin-title{font-size:18px;font-weight:800;color:#07203a}
    .close-admin{background:transparent;border:0;font-weight:800;cursor:pointer;font-size:14px}
    .admin-body{margin-top:12px;display:grid;gap:10px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-weight:700;font-size:13px;color:#243444}
    .field input[type="text"], .field input[type="password"], .field input[type="url"], .field textarea{
      padding:10px;border-radius:8px;border:1px solid rgba(8,12,20,0.08);font-size:14px;width:100%;
    }
    .field input[type="file"]{padding:6px;border-radius:6px;border:1px dashed rgba(8,12,20,0.06)}
    .admin-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:4px}
    .btn{padding:10px 14px;border-radius:8px;border:0;font-weight:800;cursor:pointer}
    .btn-save{background:linear-gradient(90deg,#0b61ff,#2b9bff);color:#fff}
    .btn-secondary{background:#f3f4f6;color:#111}
    .preview{border-radius:8px;border:1px solid rgba(8,12,20,0.06);padding:8px;display:grid;place-items:center}
    .small-muted{font-size:12px;color:#6b7280}

    @media (max-width:480px){
      .qr-frame{width:260px;height:260px}
      .title{font-size:22px}
      .admin-modal{padding:12px}
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <!-- top bar in the same card -->
      <div class="topbar">
        <div class="logo">Pay</div>
        <div class="title">Pay Here</div>
      </div>

      <!-- QR area -->
      <div class="qr-wrap">
        <div class="qr-frame" id="qrframe"><img id="qrimg" src="" alt="QR image"></div>
        <div class="controls">
          <button id="downloadBtn" class="download">Download QR Code</button>
        </div>
      </div>

      <!-- UPI thin pill with copy -->
      <div class="upi-box">
        <div class="upi-pill">
          <div class="upi-text" id="upiField">merchant@upi</div>
          <button id="copyUpi" class="copy-btn">Copy</button>
        </div>
      </div>

      <!-- App buttons -->
      <div class="apps">
        <button id="btnPaytm" class="app-btn paytm">PAYTM</button>
        <button id="btnGpay" class="app-btn gpay">G PAY</button>
        <button id="btnPhonePe" class="app-btn phonepe">Phone ‡§™‡•á</button>
        <button id="btnOther" class="app-btn other">Other UPI Apps</button>
      </div>

      <!-- carousel header (static) and carousel (images move) -->
      <div class="carousel-wrap">
        <div class="carousel-header">üì≤  How to send payment Screenshot</div>
        <div class="carousel"><div class="slides" id="slides"></div></div>
      </div>

      <!-- instructions -->
      <div class="instructions-box">
        <div class="how-title">Instruction ‚ùó</div>
        <div class="how-list" id="howList"></div>
      </div>

      <!-- contact -->
      <div class="contact-row">
        <button id="contactBtn" class="contact-btn">üí¨ Contact Admin</button>
        <div class="contact-small" id="contactSmall">Sesnd Screenshot to Admin</div>
      </div>

    </div>
  </div>

  <!-- invisible hidden trigger (bottom-left) -->
  <div class="hidden-trigger" id="hiddenTrigger" title="secret"></div>

  <!-- admin UI container (will be inserted dynamically) -->
  <div id="adminContainer"></div>

<script>
/* ================= ADMIN CONFIG (default) =================
 * You can optionally place your imgbb API key here as default.
 * If left blank, paste it inside the admin panel when you open it.
 * ========================================================= */
const DEFAULT_IMGBB_KEY = ''; // <-- optional: fill with your imgbb API key (recommended to keep blank for security)

/* ========================================================= */

// Initial ADMIN object (will be loaded/overwritten from localStorage if available)
let ADMIN = {
  upi: 'merchant@upi',
  payeeName: 'Merchant Name',
  contactLink: 'https://wa.me/919999999999',
  contactText: 'Contact Admin',
  carousel: [
    'https://i.ibb.co/gFPbGzZH/20251118-155331.jpg',
    'https://i.ibb.co/TBTd5S3p/20251118-160648.jpg',
    'https://i.ibb.co/fVJnf9V7/20251118-153613.jpg'
  ],
  instructions: [
    'Open any UPI app or scan the QR with your UPI app.',
    'Confirm the UPI ID and payee name before approving.',
    'Enter the exact amount in your UPI app (do not rely on defaults).',
    'After payment, take a screenshot and send it to admin for confirmation.'
  ],
  // customQr: if present, this is a direct image URL (uploaded to imgbb or any host)
  customQr: null,
  imgbbKey: DEFAULT_IMGBB_KEY || ''
};

/* persist key for storage */
const STORAGE_KEY = 'PAYPAGE_ADMIN_SETTINGS_V1';

/* load saved admin settings if present */
(function loadSaved(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw){
      const parsed = JSON.parse(raw);
      ADMIN = Object.assign(ADMIN, parsed);
    }
  }catch(e){ console.warn('Failed loading settings', e); }
})();

/* DOM refs */
const upiField = document.getElementById('upiField');
const qrImg = document.getElementById('qrimg');
const downloadBtn = document.getElementById('downloadBtn');
const slidesEl = document.getElementById('slides');
const howList = document.getElementById('howList');
const contactBtn = document.getElementById('contactBtn');
const adminContainer = document.getElementById('adminContainer');

/* Render UPI text */
function renderUpiText(){
  upiField.textContent = ADMIN.upi || 'merchant@upi';
}

/* Build UPI URI for QR if we need to regenerate */
function buildUpiUri(){
  const params = new URLSearchParams({pa:ADMIN.upi,pn:ADMIN.payeeName,cu:'INR'});
  return 'upi://pay?' + params.toString();
}
function googleQrUrlForUpi(){
  const uri = buildUpiUri();
  return `https://chart.googleapis.com/chart?cht=qr&chs=1000x1000&chl=${encodeURIComponent(uri)}`;
}

/* Render QR: if customQr present use it, else use Google Chart from UPI */
function renderQr(){
  if(ADMIN.customQr){
    qrImg.src = ADMIN.customQr;
  } else {
    qrImg.src = googleQrUrlForUpi();
  }
}

/* populate carousel (unchanged behavior) */
function populateCarousel(){
  slidesEl.innerHTML = '';
  ADMIN.carousel.forEach(url => {
    const s = document.createElement('div'); s.className = 'slide';
    const img = document.createElement('img'); img.src = url; img.alt = 'step';
    s.appendChild(img); slidesEl.appendChild(s);
  });
}

/* populate instructions */
function populateInstructions(){
  howList.innerHTML = '';
  ADMIN.instructions.forEach(line => {
    const d = document.createElement('div'); d.className = 'how-item'; d.textContent = line; howList.appendChild(d);
  });
}

/* initial render */
renderUpiText();
populateCarousel();
populateInstructions();
renderQr();

/* carousel autoplay */
let cIndex = 0;
function showSlide(i){ slidesEl.style.transform = `translateX(-${i*100}%)`; }
setInterval(()=>{ cIndex = (cIndex+1) % ADMIN.carousel.length; showSlide(cIndex); }, 2200);

/* Download QR: fetch -> blob -> download (best-effort) */
async function downloadQr(){
  try{
    const src = qrImg.src;
    // fetch the image (works for data URLs and CORS-allowed hosts)
    const resp = await fetch(src, {mode:'cors'});
    if(!resp.ok) throw new Error('Network response not ok');
    const blob = await resp.blob();
    triggerDownload(blob, 'upi-qr-' + Date.now() + '.png');
    showToast('QR downloaded to device');
  }catch(err){
    console.warn('Download failed, fallback to open', err);
    // fallback: open image (user can long-press to save)
    window.open(qrImg.src, '_blank');
    showToast('Could not download directly ‚Äî opened image to save manually');
  }
}
function triggerDownload(blob, filename){
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}
downloadBtn.addEventListener('click', downloadQr);

/* Copy UPI to clipboard (Copy button inside same pill) */
document.getElementById('copyUpi').addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(ADMIN.upi);
    showToast('UPI copied to clipboard');
  }catch(e){
    const t = document.createElement('textarea'); t.value = ADMIN.upi; document.body.appendChild(t); t.select();
    document.execCommand('copy'); t.remove();
    showToast('UPI copied to clipboard');
  }
});

/* App openers (no amount passed) */
const PACK = { gpay:'com.google.android.apps.nbu.paisa.user', phonepe:'com.phonepe.app', paytm:'net.one97.paytm' };
function openChain(pref){
  const query = new URLSearchParams({pa:ADMIN.upi,pn:ADMIN.payeeName,cu:'INR'}).toString();
  const generic = 'upi://pay?' + query;
  const ua = navigator.userAgent || '';
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  if(isAndroid){
    let i = 0;
    function next(){
      if(i >= pref.length){ window.location.href = generic; return; }
      const key = pref[i++]; const pkg = PACK[key];
      if(!pkg){ next(); return; }
      const intent = `intent://pay?${query}#Intent;scheme=upi;package=${pkg};end`;
      window.location.href = intent;
      setTimeout(next, 1200);
    }
    next();
  } else if(isIOS){
    window.location.href = generic;
  } else {
    alert('Open this page on a mobile device to complete the UPI payment.');
  }
}
document.getElementById('btnPaytm').addEventListener('click', ()=>openChain(['paytm','phonepe','gpay']));
document.getElementById('btnGpay').addEventListener('click', ()=>openChain(['gpay','phonepe','paytm']));
document.getElementById('btnPhonePe').addEventListener('click', ()=>openChain(['phonepe','paytm','gpay']));
document.getElementById('btnOther').addEventListener('click', ()=>{ window.location.href = 'upi://pay?pa='+encodeURIComponent(ADMIN.upi)+'&pn='+encodeURIComponent(ADMIN.payeeName)+'&cu=INR'; });

/* Contact */
contactBtn.addEventListener('click', ()=> window.open(ADMIN.contactLink, '_blank'));

/* small toast */
function showToast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed'; t.style.left='50%'; t.style.bottom='22px'; t.style.transform='translateX(-50%)';
  t.style.background='rgba(11,97,255,0.95)'; t.style.color='#fff'; t.style.padding='8px 12px';
  t.style.borderRadius='8px'; t.style.boxShadow='0 8px 20px rgba(11,97,255,0.12)'; t.style.zIndex=9999;
  document.body.appendChild(t);
  setTimeout(()=>t.style.opacity='0.01',1500); setTimeout(()=>t.remove(),2000);
}

/* fallback if QR fails to load */
qrImg.addEventListener('error', ()=>{ qrImg.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="20">QR Unavailable</text></svg>'; });

/* ================= Hidden trigger behavior =================
 * 10 clicks/taps => prompts for password
 * password: "fassvord"
 * ========================================================= */
const trigger = document.getElementById('hiddenTrigger');
let tapCount = 0;
let lastTapResetTimer = null;
const REQUIRED_TAPS = 10;
trigger.addEventListener('click', onHiddenTap);
trigger.addEventListener('touchend', onHiddenTap);

function onHiddenTap(e){
  e.preventDefault();
  tapCount++;
  if(lastTapResetTimer) clearTimeout(lastTapResetTimer);
  // reset count after 3 seconds of inactivity
  lastTapResetTimer = setTimeout(()=>{ tapCount = 0; }, 3000);
  if(tapCount >= REQUIRED_TAPS){
    tapCount = 0;
    showPasswordPrompt();
  }
}

function showPasswordPrompt(){
  const pw = prompt('Enter admin password:');
  if(pw === null) return; // cancelled
  if(pw === 'fassvord'){
    openAdminPanel();
  } else {
    alert('Incorrect password');
  }
}

/* ================= Admin panel (DOM) ================= */
let adminModalEl = null;

function openAdminPanel(){
  // Build modal markup
  adminContainer.innerHTML = '';
  const ov = document.createElement('div'); ov.className = 'admin-overlay';
  const modal = document.createElement('div'); modal.className = 'admin-modal';

  modal.innerHTML = `
    <div class="admin-header">
      <div class="admin-title">Admin Panel ‚Äî Update QR & UPI</div>
      <button class="close-admin" id="closeAdminBtn">Close ‚úï</button>
    </div>
    <div class="admin-body">
      <div class="field">
        <label>IMGBB API Key <span class="small-muted">(needed to upload image to imgbb)</span></label>
        <input type="text" id="imgbbKeyField" placeholder="Paste your imgbb API key here (or leave blank to only use URL)" value="">
        <div class="small-muted">Get a key at https://imgbb.com (Account > API) ‚Äî paste here. Alternatively you can supply an image URL below.</div>
      </div>

      <div class="field">
        <label>Upload QR Image from device (preferred)</label>
        <input type="file" id="qrFileField" accept="image/*">
        <div class="small-muted">If you upload, the image will be sent to imgbb and the returned public URL will be used as the site QR.</div>
      </div>

      <div class="field">
        <label>Or use an Image URL (public)</label>
        <input type="url" id="qrUrlField" placeholder="https://...">
        <div class="preview" id="qrPreview" style="min-height:120px"><div class="small-muted">Preview will appear here</div></div>
      </div>

      <div class="field">
        <label>UPI ID</label>
        <input type="text" id="upiFieldAdmin" placeholder="merchant@upi">
      </div>

      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
        <div class="small-muted">Changes saved will apply immediately to all users and persist.</div>
        <div class="admin-actions">
          <button class="btn btn-secondary" id="adminCancel">Cancel</button>
          <button class="btn btn-save" id="adminSave">Save</button>
        </div>
      </div>
    </div>
  `;

  ov.appendChild(modal);
  adminContainer.appendChild(ov);
  adminModalEl = ov;

  // fill fields with current values
  const imgbbKeyField = document.getElementById('imgbbKeyField');
  const qrFileField = document.getElementById('qrFileField');
  const qrUrlField = document.getElementById('qrUrlField');
  const qrPreview = document.getElementById('qrPreview');
  const upiFieldAdmin = document.getElementById('upiFieldAdmin');
  const closeAdminBtn = document.getElementById('closeAdminBtn');
  const adminCancel = document.getElementById('adminCancel');
  const adminSave = document.getElementById('adminSave');

  imgbbKeyField.value = ADMIN.imgbbKey || '';
  upiFieldAdmin.value = ADMIN.upi || '';
  qrUrlField.value = ADMIN.customQr || '';

  if(ADMIN.customQr)
    qrPreview.innerHTML = `<img src="${ADMIN.customQr}" style="max-width:100%;border-radius:6px;display:block" alt="preview">`;
  }

  // preview when user types URL
  qrUrlField.addEventListener('input', ()=>{
    const v = qrUrlField.value.trim();
    if(!v){
      qrPreview.innerHTML = `<div class="small-muted">Preview will appear here</div>`;
      return;
    }
    qrPreview.innerHTML = `<img src="${v}" style="max-width:100%;border-radius:6px;display:block" alt="preview">`;
  });

  // preview when user chooses file
  qrFileField.addEventListener('change', ()=>{
    const f = qrFileField.files && qrFileField.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = function(ev){
      qrPreview.innerHTML = `<img src="${ev.target.result}" style="max-width:100%;border-radius:6px;display:block" alt="preview">`;
      // when a file is selected, clear URL field (so file takes precedence)
      qrUrlField.value = '';
    };
    reader.readAsDataURL(f);
  });

  closeAdminBtn.addEventListener('click', closeAdminPanel);
  adminCancel.addEventListener('click', closeAdminPanel);

  adminSave.addEventListener('click', async ()=>{
    // Save logic:
    // - If file selected and imgbb key present -> upload to imgbb, get URL
    // - Else if URL provided -> set customQr to that URL
    // - Else if no file and no url -> clear customQr so generated QR from UPI will be used
    // - Update UPI value
    const imgbbKey = imgbbKeyField.value.trim();
    const file = qrFileField.files && qrFileField.files[0];
    const urlVal = qrUrlField.value.trim();
    const newUpi = upiFieldAdmin.value.trim();

    // save imgbbKey to ADMIN so persists
    ADMIN.imgbbKey = imgbbKey;
    // basic validation for UPI
    if(!newUpi){
      alert('Please enter a UPI ID');
      return;
    }

    showToast('Saving changes...');

    try{
      let finalQrUrl = null;

      if(file){
        // require imgbb key for upload
        if(!imgbbKey){
          const want = confirm('You selected a file but no imgbb API key is set. Without the key the file cannot be uploaded to imgbb. Do you want to paste the key now?');
          if(!want) {
            return;
          } else {
            // do nothing; user can paste key in the field
            return;
          }
        }
        // read file as base64 and upload to imgbb
        finalQrUrl = await uploadFileToImgbb(file, imgbbKey);
        if(!finalQrUrl) throw new Error('Upload failed');
      } else if(urlVal){
        finalQrUrl = urlVal;
      } else {
        finalQrUrl = null; // use generated google QR from UPI
      }

      // commit changes
      ADMIN.upi = newUpi;
      ADMIN.customQr = finalQrUrl;

      // persist
      localStorage.setItem(STORAGE_KEY, JSON.stringify(ADMIN));

      // re-render live
      renderUpiText();
      renderQr();

      showToast('Saved. Admin panel will close.');
      setTimeout(()=>{ closeAdminPanel(); }, 700);

    }catch(err){
      console.error('Save failed', err);
      alert('Failed to save / upload: ' + (err.message || err));
    }
  });
}

// close and remove admin modal
function closeAdminPanel(){
  if(adminModalEl){
    adminContainer.innerHTML = '';
    adminModalEl = null;
  }
}

/* upload file to imgbb by reading base64 and POSTing to imgbb API.
   returns public image url on success. */
async function uploadFileToImgbb(file, apiKey){
  try{
    showToast('Uploading image to imgbb...');
    // read file as data URL
    const dataUrl = await new Promise((res, rej)=>{
      const reader = new FileReader();
      reader.onload = () => res(reader.result);
      reader.onerror = rej;
      reader.readAsDataURL(file);
    });
    // extract base64
    const base64 = dataUrl.split(',')[1];
    // Build form data
    const body = new URLSearchParams();
    body.append('image', base64);
    // optional name param
    body.append('name', 'qr_' + Date.now());
    const resp = await fetch(`https://api.imgbb.com/1/upload?key=${encodeURIComponent(apiKey)}`, {
      method: 'POST',
      body
    });
    const json = await resp.json();
    if(!json || !json.success){
      throw new Error(json && json.error && json.error.message ? json.error.message : 'Unknown upload error');
    }
    // returned URL
    const url = json.data && json.data.display_url ? json.data.display_url : (json.data && json.data.url ? json.data.url : null);
    if(!url) throw new Error('Invalid response from imgbb');
    showToast('Image uploaded');
    return url;
  }catch(err){
    console.error('imgbb upload error', err);
    alert('Image upload failed: ' + (err.message || err));
    return null;
  }
}

/* Accessibility: also open admin panel by pressing Ctrl+Shift+K (for developer convenience) */
document.addEventListener('keydown', (e)=>{
  if(e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'k'){
    const pw = prompt('Enter admin password:');
    if(pw === 'fassvord') openAdminPanel(); else alert('Incorrect password');
  }
});

/* Small UX: ensure contact button remains center - don't change */
document.getElementById('contactBtn').textContent = (ADMIN.contactText || 'Contact Admin') + '  üí¨';

/* END OF SCRIPT */
</script>
</body>
</html>
