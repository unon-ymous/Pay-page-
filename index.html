<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pay Here ‚Äî UPI Payment</title>
  <style>
    :root{
      --page-bg:#eef6fb;
      --panel:#ffffff;
      --muted:#6b7280;
      --accent:#0b61ff;
      --radius:12px;
      --shadow:0 10px 30px rgba(12,20,40,0.06);
      --light-gray:#f3f4f6;
      --copy-gray:#eef2f6;
      --btn-darker-overlay: rgba(0,0,0,0.04);
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--page-bg);color:#0f1724}

    /* container */
    .page{max-width:760px;margin:18px auto;padding:0 12px}
    .card{background:linear-gradient(180deg,#f8fcff,#ffffff);border-radius:16px;padding:14px;box-shadow:var(--shadow);overflow:hidden}

    /* topbar */
    .topbar{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg,#e6f5ff,#dff2ff)}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#0b61ff,#33a1ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
    .title{font-size:26px;font-style:italic;color:#08324a;font-weight:800;letter-spacing:0.3px}

    /* QR area */
    .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px}
    .qr-frame{width:320px;height:320px;border-radius:12px;border:1px dashed rgba(8,12,20,0.06);overflow:hidden;background:#fff;display:grid;place-items:center}
    .qr-frame img{width:100%;height:100%;object-fit:cover;display:block}
    .controls{display:flex;gap:10px;align-items:center;width:92%}
    .download{flex:1;padding:12px;border-radius:18px;background:linear-gradient(90deg,#dff7e1,#c6f0c9);border:1px solid rgba(10,91,46,0.08);font-weight:700;cursor:pointer}

    /* UPI single thin box with copy inside */
    .upi-box{margin-top:10px;display:flex;align-items:center;gap:8px;width:92%}
    .upi-pill{flex:1;display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;background:#fafcff;border:1px solid rgba(8,12,20,0.06);font-weight:700}
    .upi-text{font-size:15px;color:#0b1f2f}
    .copy-btn{padding:6px 10px;border-radius:8px;background:var(--copy-gray);color:#425066;border:0;cursor:pointer;font-weight:700}

    /* apps */
    .apps{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .app-btn{padding:12px;border-radius:10px;border:0;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 2px 6px rgba(2,6,23,0.03)}
    .app-btn img{width:18px;height:18px;display:inline-block;vertical-align:middle}
    /* slightly darker look for buttons */
    .paytm{background:linear-gradient(90deg,#dfe9ff,#cfe0ff);color:#003366}
    .gpay{background:linear-gradient(90deg,#fffefc,#fff7ed);color:#111;border:1px solid rgba(0,0,0,0.06)}
    .phonepe{background:linear-gradient(90deg,#eee3ff,#e8dbff);color:#3a0b66}
    .other{background:linear-gradient(90deg,#f4f4f6,#ececec);color:#111} /* light gray */

    /* carousel + static header */
    .carousel-wrap{margin-top:12px}
    .carousel-header{
      padding:8px;
      border-radius:8px;
      background:linear-gradient(180deg,#f5f7fa,#ffffff);
      border:1px solid rgba(8,12,20,0.04);
      color:#475569;
      font-weight:700;
      font-size:14px;
    }

    .carousel{
      margin-top:8px;
      overflow:hidden;
      border-radius:8px;
      height:340px;
      position:relative;
    }

    .slides{
      display:flex;
      transition:transform 600ms cubic-bezier(.2,.8,.2,1);
      gap:0;
      height:100%;
      width:100%;
      will-change: transform;
    }

    .slide{
      min-width:100%;
      flex-shrink:0;
      padding:0;
      height:100%;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .slide img{
      width:100%;
      height:340px;
      object-fit:contain;
      border-radius:8px;
    }

    /* placeholder for empty carousel */
    .carousel-empty{
      display:flex;
      align-items:center;
      justify-content:center;
      height:100%;
      color:#94a3b8;
      font-weight:600;
      background:linear-gradient(180deg,#fff,#fbfdff);
      border-radius:8px;
    }

    /* instructions in light shiny box (smaller text) */
    .instructions-box{margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#f8fbff,#ffffff);border:1px solid rgba(8,12,20,0.04);box-shadow:0 6px 18px rgba(11,97,255,0.03)}
    .how-title{font-weight:800;color:#111;margin-bottom:8px}
    .how-list{display:flex;flex-direction:column;gap:6px}
    .how-item{background:transparent;padding:6px;color:#475569;font-size:13px}

    /* contact */
    .contact-row{display:flex;flex-direction:column;align-items:center;gap:8px;margin-top:14px}
    .contact-btn{padding:12px 18px;border-radius:8px;background:#f3f4f6;color:#111;border:0;font-weight:800;cursor:pointer}
    .contact-small{font-size:13px;color:var(--muted);text-align:center}

    @media (max-width:480px){
      .qr-frame{width:260px;height:260px}
      .title{font-size:22px}
    }

    .disabled { opacity: 0.5; pointer-events: none; }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <!-- top bar -->
      <div class="topbar">
        <div class="logo">Pay</div>
        <div class="title">Pay Here</div>
      </div>

      <!-- QR area -->
      <div class="qr-wrap">
        <div class="qr-frame" id="qrframe"><img id="qrimg" src="" alt="QR image"></div>
        <div class="controls">
          <button id="downloadBtn" class="download">Download QR Code</button>
        </div>
      </div>

      <!-- UPI pill -->
      <div class="upi-box">
        <div class="upi-pill">
          <div class="upi-text" id="upiField"></div>
          <button id="copyUpi" class="copy-btn">Copy</button>
        </div>
      </div>

      <!-- App buttons with logos -->
      <div class="apps">
        <button id="btnPaytm" class="app-btn paytm">
          PAYTM
          <!-- Paytm svg (small) -->
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><rect width='24' height='24' rx='4' fill='%23005ea6'/><text x='12' y='15' font-size='10' fill='white' font-family='Arial' text-anchor='middle' font-weight='700'>P</text></svg>" alt="paytm">
        </button>

        <button id="btnGpay" class="app-btn gpay">
          G PAY
          <!-- Google Pay style: G colored 'G' -->
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 48 48'><circle cx='24' cy='24' r='22' fill='white'/><text x='24' y='30' font-size='22' text-anchor='middle' font-family='Arial' font-weight='700' fill='%231b73e8'>G</text></svg>" alt="gpay">
        </button>

        <button id="btnPhonePe" class="app-btn phonepe">
          Phone ‡§™‡•á
          <!-- PhonePe svg -->
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><rect width='24' height='24' rx='4' fill='%233a0b66'/><text x='12' y='15' font-size='10' fill='white' font-family='Arial' text-anchor='middle' font-weight='700'>P</text></svg>" alt="phonepe">
        </button>

        <button id="btnOther" class="app-btn other">
          Other UPI
          <!-- UPI official small logo approximation (gray) -->
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><rect width='24' height='24' rx='4' fill='%23e8e8ea'/><text x='12' y='15' font-size='10' fill='%23636a6f' font-family='Arial' text-anchor='middle' font-weight='700'>UPI</text></svg>" alt="upi">
        </button>
      </div>

      <!-- carousel -->
      <div class="carousel-wrap">
        <div class="carousel-header">üì≤  How to send payment Screenshot</div>
        <div class="carousel" id="carouselRoot">
          <div class="slides" id="slides"></div>
        </div>
      </div>

      <!-- instructions -->
      <div class="instructions-box">
        <div class="how-title">Instruction ‚ùó</div>
        <div class="how-list" id="howList">
          <div class="how-item">Open any UPI app or scan the QR with your UPI app.</div>
          <div class="how-item">Confirm the UPI ID before approving.</div>
          <div class="how-item">Enter the exact amount in your UPI app (do not rely on defaults).</div>
          <div class="how-item">After payment, take a screenshot and send it to admin for confirmation.</div>
        </div>
      </div>

      <!-- contact -->
      <div class="contact-row">
        <button id="contactBtn" class="contact-btn">Contact Admin</button>
        <div class="contact-small" id="contactSmall">Send Screenshot to Admin</div>
      </div>
    </div>
  </div>

<script>
/*
  INDEX.HTML:
  - Uses hardcoded carousel images and contact link/text (below).
  - Loads only `qrlink` and `upiid` from external config.js (cache-busted and polled).
*/

/* ========== Hardcoded values (as requested) ========== */
const CAROUSEL_IMAGES = [
  "https://i.ibb.co/gFPbGzZH/20251118-155331.jpg",
  "https://i.ibb.co/TBTd5S3p/20251118-160648.jpg",
  "https://i.ibb.co/fVJnf9V7/20251118-153613.jpg"
];
const CONTACT_LINK = "https://wa.me/919999999999";
const CONTACT_TEXT = "Contact Admin";
/* ==================================================== */

const upiField = document.getElementById('upiField');
const qrImg = document.getElementById('qrimg');
const downloadBtn = document.getElementById('downloadBtn');
const slidesEl = document.getElementById('slides');
const carouselRoot = document.getElementById('carouselRoot');
const contactBtn = document.getElementById('contactBtn');
const copyBtn = document.getElementById('copyUpi');

let currentConfig = null;
let configScriptEl = null;
let carouselInterval = null;
let autoStartTimeout = null;

/* small toast */
function showToast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed'; t.style.left='50%'; t.style.bottom='22px'; t.style.transform='translateX(-50%)';
  t.style.background='rgba(11,97,255,0.95)'; t.style.color='#fff'; t.style.padding='8px 12px';
  t.style.borderRadius='8px'; t.style.boxShadow='0 8px 20px rgba(11,97,255,0.12)'; t.style.zIndex=9999;
  document.body.appendChild(t);
  setTimeout(()=>t.style.opacity='0.01',1500); setTimeout(()=>t.remove(),2000);
}

/* Apply config (only qrlink and upiid come from external config.js) */
function applyConfig(cfg){
  currentConfig = cfg || null;

  // UPI field
  if(currentConfig && typeof currentConfig.upiid === 'string' && currentConfig.upiid.trim()){
    upiField.textContent = currentConfig.upiid.trim();
    copyBtn.classList.remove('disabled'); copyBtn.disabled = false;
    // enable app buttons
    document.querySelectorAll('.app-btn').forEach(b => { b.classList.remove('disabled'); b.disabled = false; });
  } else {
    upiField.textContent = '';
    copyBtn.classList.add('disabled'); copyBtn.disabled = true;
    document.querySelectorAll('.app-btn').forEach(b => { b.classList.add('disabled'); b.disabled = true; });
  }

  // QR image
  if(currentConfig && typeof currentConfig.qrlink === 'string' && currentConfig.qrlink.trim()){
    qrImg.src = currentConfig.qrlink.trim();
    qrImg.alt = 'QR image';
    downloadBtn.classList.remove('disabled'); downloadBtn.disabled = false;
  } else {
    qrImg.src = '';
    qrImg.alt = 'No QR configured';
    downloadBtn.classList.add('disabled'); downloadBtn.disabled = true;
  }

  // Contact button (hardcoded link/text)
  if(CONTACT_LINK){
    contactBtn.dataset.link = CONTACT_LINK;
    contactBtn.textContent = CONTACT_TEXT;
    contactBtn.classList.remove('disabled'); contactBtn.disabled = false;
  } else {
    contactBtn.dataset.link = '';
    contactBtn.textContent = 'Contact Admin';
    contactBtn.classList.add('disabled'); contactBtn.disabled = true;
  }

  // Carousel: always use hardcoded CAROUSEL_IMAGES
  setupCarousel(CAROUSEL_IMAGES);
}

/* ---------- Carousel logic: infinite loop right-to-left ---------- */
/* Approach:
   - Build slides for each image.
   - Clone first slide and append to end.
   - Start at index 0. Advance index++ every DISPLAY_MS.
   - On transitionend, if index == slidesCount (which is clone), reset to 0 instantly without transition.
   - Each slide remains visible for DISPLAY_MS before next slide.
*/
const DISPLAY_MS = 2500;    // time each image stays
const TRANSITION_MS = 600;  // CSS transition duration should match

function setupCarousel(urls){
  // clear existing
  clearCarousel();

  if(!Array.isArray(urls) || urls.length === 0){
    showEmptyPlaceholder();
    return;
  }

  // populate slides
  urls.forEach(url => {
    const slide = createSlide(url);
    slidesEl.appendChild(slide);
  });

  // clone first slide to allow seamless transition from last -> first
  if(urls.length > 1){
    const firstClone = slidesEl.children[0].cloneNode(true);
    firstClone.classList.add('clone');
    slidesEl.appendChild(firstClone);
  }

  // ensure slidesEl has transform 0
  slidesEl.style.transition = 'none';
  slidesEl.style.transform = 'translateX(0%)';

  // wait for images to load (or short timeout) before starting auto cycle to avoid flicker
  waitForImagesThenStart();
}

function createSlide(url){
  const s = document.createElement('div');
  s.className = 'slide';
  const img = document.createElement('img');
  img.src = url;
  img.alt = 'step';
  // handle broken image gracefully
  img.addEventListener('error', ()=> {
    img.style.display = 'none';
    const err = document.createElement('div');
    err.style.width = '100%';
    err.style.height = '100%';
    err.style.display = 'flex';
    err.style.alignItems = 'center';
    err.style.justifyContent = 'center';
    err.style.color = '#94a3b8';
    err.style.fontWeight = 700;
    err.textContent = 'Image unavailable';
    s.appendChild(err);
  });
  s.appendChild(img);
  return s;
}

function clearCarousel(){
  stopCarousel();
  while(slidesEl.firstChild) slidesEl.removeChild(slidesEl.firstChild);
  const ph = carouselRoot.querySelector('.carousel-empty');
  if(ph) ph.remove();
}

function showEmptyPlaceholder(){
  clearCarousel();
  const ph = document.createElement('div');
  ph.className = 'carousel-empty';
  ph.textContent = 'No tutorial images configured';
  carouselRoot.appendChild(ph);
}

/* Wait for visible images (first N) to load or timeout, then start auto cycle */
function waitForImagesThenStart(){
  stopCarousel();
  const imgs = slidesEl.querySelectorAll('img');
  if(imgs.length === 0){
    // nothing to show
    return;
  }

  let loaded = 0;
  const total = imgs.length;
  let done = false;

  function tryStart(){
    if(done) return;
    done = true;
    // small delay to allow user to see first image (so not immediate slide)
    // set transition back to CSS and start cycle
    slidesEl.style.transition = `transform ${TRANSITION_MS}ms cubic-bezier(.2,.8,.2,1)`;
    startCarousel();
  }

  imgs.forEach(img => {
    if(img.complete){
      loaded++;
    } else {
      img.addEventListener('load', ()=> { loaded++; if(loaded >= 1 && !done){ tryStart(); } });
      img.addEventListener('error', ()=> { loaded++; if(loaded >= 1 && !done){ tryStart(); } });
    }
  });

  // If at least one image is loaded already, start after short delay to avoid flicker
  if(loaded >= 1){
    setTimeout(() => { if(!done) tryStart(); }, 60); // micro delay
  } else {
    // fallback: start after 400ms if nothing loads (avoid infinite wait)
    setTimeout(() => { if(!done) tryStart(); }, 400);
  }
}

function startCarousel(){
  stopCarousel();
  const slidesCountReal = slidesEl.children.length;
  if(slidesCountReal === 0) return;
  // number of logical slides (without clone)
  const logicalCount = (slidesCountReal > 1 && slidesEl.children[slidesCountReal - 1].classList.contains('clone'))
                       ? slidesCountReal - 1
                       : slidesCountReal;

  let index = 0;
  // Ensure first slide is visible
  slidesEl.style.transform = `translateX(0%)`;

  // Advance function
  function advance(){
    index++;
    // move
    slidesEl.style.transform = `translateX(-${index * 100}%)`;
    // When transition ends, check if we've reached clone
    const onTransitionEnd = function(){
      slidesEl.removeEventListener('transitionend', onTransitionEnd);
      // if index equals logicalCount, we are at the clone -> reset to 0 instantly
      if(index >= logicalCount){
        // reset without animation
        slidesEl.style.transition = 'none';
        slidesEl.style.transform = 'translateX(0%)';
        index = 0;
        // Force reflow then restore transition so next advance will animate
        // eslint-disable-next-line no-unused-expressions
        slidesEl.offsetHeight;
        slidesEl.style.transition = `transform ${TRANSITION_MS}ms cubic-bezier(.2,.8,.2,1)`;
      }
    };
    slidesEl.addEventListener('transitionend', onTransitionEnd, { once: true });
  }

  // Start the interval: show first image for DISPLAY_MS then advance, then every DISPLAY_MS advance
  // Use setInterval but ensure first delay is DISPLAY_MS (so each image stays for DISPLAY_MS)
  carouselInterval = setInterval(advance, DISPLAY_MS);
  // Also keep a timeout to start first advance after DISPLAY_MS so first image stays
  autoStartTimeout = setTimeout(advance, DISPLAY_MS);
}

function stopCarousel(){
  if(carouselInterval){ clearInterval(carouselInterval); carouselInterval = null; }
  if(autoStartTimeout){ clearTimeout(autoStartTimeout); autoStartTimeout = null; }
}

/* ========== config loader (only qrlink & upiid used) ========== */
function removeExistingConfigScript(){
  if(configScriptEl && configScriptEl.parentNode) configScriptEl.remove();
  configScriptEl = null;
}

function loadConfigScript(){
  try { delete window.CONFIG; } catch(e) { window.CONFIG = undefined; }
  removeExistingConfigScript();
  const s = document.createElement('script');
  s.src = 'config.js?ts=' + Date.now();
  s.id = 'configScript';
  s.async = true;
  s.onload = () => {
    if(window.CONFIG && typeof window.CONFIG === 'object'){
      applyConfig(window.CONFIG);
      console.info('CONFIG loaded:', window.CONFIG);
    } else {
      console.warn('config.js loaded but window.CONFIG invalid or missing.');
      applyConfig(null);
    }
  };
  s.onerror = () => {
    console.warn('Failed to load config.js');
    applyConfig(null);
  };
  document.head.appendChild(s);
  configScriptEl = s;
}

/* Polling to auto-sync config changes (as before) */
const CONFIG_POLL_INTERVAL_MS = 2500;
loadConfigScript();
setInterval(loadConfigScript, CONFIG_POLL_INTERVAL_MS);

/* ========== Download QR ========== */
async function downloadQr(){
  try{
    const src = qrImg.src;
    if(!src) throw new Error('No QR configured');
    const resp = await fetch(src, {mode:'cors'});
    if(!resp.ok) throw new Error('Network response not ok');
    const blob = await resp.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'upi-qr-' + Date.now() + '.png'; document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
    showToast('QR downloaded to device');
  }catch(err){
    console.warn('Download failed, fallback to open', err);
    if(qrImg.src){
      window.open(qrImg.src, '_blank');
      showToast('Could not download directly ‚Äî opened image to save manually');
    } else {
      showToast('No QR configured to download');
    }
  }
}
document.getElementById('downloadBtn').addEventListener('click', downloadQr);

/* ========== Copy UPI to clipboard ========== */
copyBtn.addEventListener('click', async ()=>{
  if(!currentConfig || !currentConfig.upiid){ showToast('No UPI configured'); return; }
  try{
    await navigator.clipboard.writeText(currentConfig.upiid);
    showToast('UPI copied to clipboard');
  }catch(e){
    const t = document.createElement('textarea'); t.value = currentConfig.upiid; document.body.appendChild(t); t.select();
    document.execCommand('copy'); t.remove();
    showToast('UPI copied to clipboard');
  }
});

/* ========== App openers ========== */
const PACK = { gpay:'com.google.android.apps.nbu.paisa.user', phonepe:'com.phonepe.app', paytm:'net.one97.paytm' };
function openChain(pref){
  if(!currentConfig || !currentConfig.upiid){
    alert('UPI ID not configured.');
    return;
  }
  const query = new URLSearchParams({pa: currentConfig.upiid, cu:'INR'}).toString();
  const generic = 'upi://pay?' + query;
  const ua = navigator.userAgent || '';
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  if(isAndroid){
    let i = 0;
    function next(){
      if(i >= pref.length){ window.location.href = generic; return; }
      const key = pref[i++]; const pkg = PACK[key];
      if(!pkg){ next(); return; }
      const intent = `intent://pay?${query}#Intent;scheme=upi;package=${pkg};end`;
      window.location.href = intent;
      setTimeout(next, 1200);
    }
    next();
  } else if(isIOS){
    window.location.href = generic;
  } else {
    alert('Open this page on a mobile device to complete the UPI payment.');
  }
}
document.getElementById('btnPaytm').addEventListener('click', ()=>openChain(['paytm','phonepe','gpay']));
document.getElementById('btnGpay').addEventListener('click', ()=>openChain(['gpay','phonepe','paytm']));
document.getElementById('btnPhonePe').addEventListener('click', ()=>openChain(['phonepe','paytm','gpay']));
document.getElementById('btnOther').addEventListener('click', ()=> {
  if(!currentConfig || !currentConfig.upiid){ alert('UPI ID not configured.'); return; }
  window.location.href = 'upi://pay?pa=' + encodeURIComponent(currentConfig.upiid) + '&cu=INR';
});

/* ========== Contact button ========== */
contactBtn.addEventListener('click', ()=>{
  const link = contactBtn.dataset.link || '';
  if(link) window.open(link, '_blank');
  else showToast('Contact link not configured');
});

/* ========== QR image error fallback ========== */
qrImg.addEventListener('error', ()=>{
  qrImg.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="20">QR Unavailable</text></svg>'
  );
});
</script>
</body>
</html>
